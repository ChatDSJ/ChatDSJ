2025-05-12 09:18:02.215 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:18:02.314 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:18:02.314 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:18:02.341 | INFO     | services.cached_notion_service:__init__:65 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:18:02.873 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:18:03.074 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:18:03.074 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:18:03.083 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:18:03.083 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:18:03.110 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:18:27.564 | ERROR    | main:handle_mention:132 - Error handling mention: 'CachedNotionService' object has no attribute 'handle_nickname_command'
2025-05-12 09:20:06.298 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:20:06.461 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:20:06.461 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:20:06.496 | INFO     | services.cached_notion_service:__init__:65 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:20:07.176 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:20:07.399 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:20:07.400 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:20:07.402 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:20:07.403 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:20:07.435 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:20:19.989 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:20:20.074 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:20:20.074 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:20:20.098 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:20:20.644 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:20:20.858 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:20:20.858 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:20:20.860 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:20:20.861 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:20:20.889 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:20:42.084 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:20:42.088 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: <@U08RG89NFK7> are you fully operational like the ...
2025-05-12 09:20:42.089 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:20:42.673 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 90 messages from channel C08S6PE143A.
2025-05-12 09:20:42.673 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747056041.910509 (limit: 1000)...
2025-05-12 09:20:42.944 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747056041.910509.
2025-05-12 09:20:44.401 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:20:44.704 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:20:47.835 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:20:47.840 | INFO     | services.openai_service:get_completion_async:151 - Sending 4756 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:21:43.168 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:21:43.173 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: What's my nickname, <@U08RG89NFK7>?...
2025-05-12 09:21:43.173 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:21:43.859 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 90 messages from channel C08S6PE143A.
2025-05-12 09:21:43.859 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747056041.910509 (limit: 1000)...
2025-05-12 09:21:44.164 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747056041.910509.
2025-05-12 09:21:44.166 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:21:44.178 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:21:44.183 | INFO     | services.openai_service:get_completion_async:151 - Sending 4803 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:22:15.944 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:22:15.955 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what projects am I working on?...
2025-05-12 09:22:15.956 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:22:16.455 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 91 messages from channel C08S6PE143A.
2025-05-12 09:22:16.456 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747056135.741959 (limit: 1000)...
2025-05-12 09:22:16.705 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747056135.741959.
2025-05-12 09:22:16.707 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:22:16.717 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:22:16.722 | INFO     | services.openai_service:get_completion_async:151 - Sending 4780 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:23:13.731 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:23:13.734 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what do you remember about me?...
2025-05-12 09:23:13.734 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:23:14.172 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 92 messages from channel C08S6PE143A.
2025-05-12 09:23:14.172 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747056193.505699 (limit: 1000)...
2025-05-12 09:23:14.395 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747056193.505699.
2025-05-12 09:23:14.396 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:23:14.403 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:23:14.408 | INFO     | services.openai_service:get_completion_async:151 - Sending 4806 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:24:38.338 | INFO     | services.cached_notion_service:store_user_nickname:503 - Updating Notion page for user U089YKL1T4H with nickname: EL ROJO
2025-05-12 09:24:52.428 | INFO     | services.cached_notion_service:invalidate_user_cache:110 - Cache invalidated for user U089YKL1T4H
2025-05-12 09:25:45.645 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:25:45.830 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:25:45.830 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:25:45.857 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:25:46.713 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:25:46.925 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:25:46.925 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:25:46.929 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:25:46.929 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:25:46.950 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:25:54.637 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:25:54.745 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:25:54.745 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:25:54.766 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:25:55.296 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:25:55.495 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:25:55.495 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:25:55.497 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:25:55.497 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:25:55.515 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:26:22.998 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:26:23.086 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:26:23.086 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:26:23.129 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:26:23.601 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:26:23.824 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:26:23.825 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:26:23.827 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:26:23.827 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:26:23.856 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:27:11.313 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:27:11.403 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:27:11.403 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:27:11.424 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:27:12.004 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:27:12.217 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:27:12.218 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:27:12.220 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:27:12.221 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:27:12.243 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:28:06.254 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:28:06.403 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I work remotely from Spain....
2025-05-12 09:28:06.405 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:28:06.954 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 93 messages from channel C08S6PE143A.
2025-05-12 09:28:06.955 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747056485.309709 (limit: 1000)...
2025-05-12 09:28:07.186 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747056485.309709.
2025-05-12 09:28:08.591 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:28:08.919 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:28:09.247 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:28:09.254 | INFO     | services.openai_service:get_completion_async:151 - Sending 4829 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:30:49.893 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:30:49.974 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:30:49.974 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:30:49.998 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:30:50.767 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:30:50.973 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:30:50.973 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:30:50.975 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:30:50.976 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:30:51.000 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:33:10.521 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:33:10.631 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:33:10.631 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:33:10.654 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:33:11.369 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:33:11.592 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:33:11.592 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:33:11.594 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:33:11.595 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:33:11.618 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:33:59.470 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:33:59.559 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:33:59.560 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:33:59.580 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:34:00.071 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:34:00.285 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:34:00.285 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:34:00.287 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:34:00.288 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:34:00.313 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:34:31.034 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:34:31.053 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I work remotely from Spain....
2025-05-12 09:34:31.056 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:34:31.509 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 94 messages from channel C08S6PE143A.
2025-05-12 09:34:31.509 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747056869.982989 (limit: 1000)...
2025-05-12 09:34:31.757 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747056869.982989.
2025-05-12 09:34:34.151 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:34:35.382 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:34:35.726 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:34:35.730 | INFO     | services.openai_service:get_completion_async:151 - Sending 4854 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:43:53.131 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:43:53.227 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:43:53.228 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:43:53.256 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:43:55.947 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:43:56.159 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:43:56.160 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:43:56.162 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:43:56.162 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:43:56.187 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:44:53.865 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:44:53.954 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:44:53.954 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:44:53.975 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:44:54.445 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:44:54.645 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:44:54.646 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:44:54.648 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:44:54.649 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:44:54.680 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:45:27.956 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:45:27.966 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> I work remotely from Greece...
2025-05-12 09:45:27.967 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:45:28.619 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 95 messages from channel C08S6PE143A.
2025-05-12 09:45:28.619 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747057526.867569 (limit: 1000)...
2025-05-12 09:45:28.850 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747057526.867569.
2025-05-12 09:45:32.743 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:45:34.334 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:45:34.657 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:45:34.662 | INFO     | services.openai_service:get_completion_async:151 - Sending 4880 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:46:04.063 | INFO     | actions.action_framework:__init__:694 - ActionRouter initialized with 4 actions
2025-05-12 09:46:04.070 | INFO     | actions.action_framework:_get_action_for_text:708 - Selected action ContextResponseAction for message: Yes <@U08RG89NFK7> please update that...
2025-05-12 09:46:04.071 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:46:04.517 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 95 messages from channel C08S6PE143A.
2025-05-12 09:46:04.517 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747057526.867569 (limit: 1000)...
2025-05-12 09:46:04.782 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747057526.867569.
2025-05-12 09:46:04.783 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:46:04.790 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 09:46:04.795 | INFO     | services.openai_service:get_completion_async:151 - Sending 4952 tokens to OpenAI async. Model: gpt-4o
2025-05-12 09:50:06.398 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:50:06.531 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:50:06.531 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:50:06.551 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:50:07.077 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:50:07.316 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:50:07.316 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:50:07.318 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:50:07.318 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:50:07.342 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:50:27.229 | INFO     | actions.action_framework:__init__:711 - ActionRouter initialized with 4 actions
2025-05-12 09:50:27.236 | INFO     | actions.action_framework:_get_action_for_text:725 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I work remotely from Berlin....
2025-05-12 09:50:27.237 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:50:27.792 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 96 messages from channel C08S6PE143A.
2025-05-12 09:50:27.793 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747057826.867489 (limit: 1000)...
2025-05-12 09:50:28.036 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747057826.867489.
2025-05-12 09:50:30.776 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:50:30.969 | ERROR    | actions.action_framework:execute:317 - Error in ContextResponseAction: No module named 'app.services'
2025-05-12 09:50:30.969 | ERROR    | main:handle_mention:119 - Action failed: No module named 'app.services'
2025-05-12 09:51:17.760 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:51:17.894 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:51:17.894 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:51:17.932 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:51:18.521 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:51:18.737 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:51:18.738 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:51:18.740 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:51:18.741 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:51:18.768 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:51:37.610 | INFO     | actions.action_framework:__init__:711 - ActionRouter initialized with 4 actions
2025-05-12 09:51:37.618 | INFO     | actions.action_framework:_get_action_for_text:725 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I work remotely from Berlin....
2025-05-12 09:51:37.618 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:51:38.176 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 97 messages from channel C08S6PE143A.
2025-05-12 09:51:38.177 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747057896.316829 (limit: 1000)...
2025-05-12 09:51:38.404 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747057896.316829.
2025-05-12 09:51:40.936 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:51:41.411 | ERROR    | actions.action_framework:execute:317 - Error in ContextResponseAction: No module named 'app.services'
2025-05-12 09:51:41.411 | ERROR    | main:handle_mention:119 - Action failed: No module named 'app.services'
2025-05-12 09:52:44.842 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:52:44.945 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:52:44.946 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:52:44.979 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:52:45.524 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:52:45.742 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:52:45.743 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:52:45.745 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:52:45.745 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:52:45.775 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:52:59.473 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 09:52:59.562 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 09:52:59.562 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 09:52:59.584 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 09:53:00.166 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 09:53:00.373 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 09:53:00.374 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 09:53:00.377 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 09:53:00.377 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 09:53:00.397 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 09:53:10.077 | INFO     | actions.action_framework:__init__:711 - ActionRouter initialized with 4 actions
2025-05-12 09:53:10.079 | INFO     | actions.action_framework:_get_action_for_text:725 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I work remotely from Berlin....
2025-05-12 09:53:10.079 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 09:53:10.532 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 98 messages from channel C08S6PE143A.
2025-05-12 09:53:10.532 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747057989.167959 (limit: 1000)...
2025-05-12 09:53:10.768 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747057989.167959.
2025-05-12 09:53:13.190 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 09:53:13.473 | ERROR    | actions.action_framework:execute:317 - Error in ContextResponseAction: 'CachedNotionService' object has no attribute 'append_fact_to_user_page'
2025-05-12 09:53:13.473 | ERROR    | main:handle_mention:119 - Action failed: 'CachedNotionService' object has no attribute 'append_fact_to_user_page'
2025-05-12 10:10:38.659 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:10:38.749 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:10:38.749 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:10:38.771 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:10:39.316 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:10:39.561 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:10:39.561 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:10:39.566 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:10:39.566 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:10:39.584 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:12:03.988 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:12:04.101 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:12:04.101 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:12:04.125 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:12:04.702 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:12:04.912 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:12:04.912 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:12:04.914 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:12:04.915 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:12:04.944 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:13:10.949 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:13:11.080 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:13:11.080 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:13:11.156 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:13:11.760 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:13:11.963 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:13:11.963 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:13:11.966 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:13:11.966 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:13:11.992 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:13:52.082 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:13:52.167 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:13:52.167 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:13:52.188 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:13:52.697 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:13:52.904 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:13:52.905 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:13:52.907 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:13:52.907 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:13:52.928 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:14:09.579 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:14:09.663 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:14:09.663 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:14:09.683 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:14:10.207 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:14:10.417 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:14:10.417 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:14:10.421 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:14:10.421 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:14:10.446 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:14:43.667 | INFO     | actions.action_framework:__init__:724 - ActionRouter initialized with 4 actions
2025-05-12 10:14:43.675 | INFO     | actions.action_framework:_get_action_for_text:738 - Selected action ContextResponseAction for message: I work remotely from La Pampana <@U08RG89NFK7>...
2025-05-12 10:14:43.679 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:14:44.212 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 101 messages from channel C08S6PE143A.
2025-05-12 10:14:44.213 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747059275.353729 (limit: 1000)...
2025-05-12 10:14:44.441 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747059275.353729.
2025-05-12 10:14:46.150 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 10:14:46.752 | ERROR    | actions.action_framework:execute:316 - Error in ContextResponseAction: name 'handle_memory_instruction' is not defined
2025-05-12 10:14:46.752 | ERROR    | main:handle_mention:119 - Action failed: name 'handle_memory_instruction' is not defined
2025-05-12 10:19:00.818 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:19:00.897 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:19:00.897 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:19:00.919 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:19:01.604 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:19:01.843 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:19:01.843 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:19:01.845 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:19:01.845 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:19:01.870 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:20:34.451 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:20:34.552 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:20:34.552 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:20:34.617 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:20:35.174 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:20:35.377 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:20:35.377 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:20:35.380 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:20:35.380 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:20:35.405 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:20:45.793 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:20:45.909 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:20:45.909 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:20:45.931 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:20:46.388 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:20:46.591 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:20:46.592 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:20:46.594 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:20:46.594 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:20:46.613 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:21:01.870 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:21:01.878 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I work remotely from La Prangana...
2025-05-12 10:21:01.879 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:21:02.579 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 102 messages from channel C08S6PE143A.
2025-05-12 10:21:02.580 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747059662.379379 (limit: 1000)...
2025-05-12 10:21:02.823 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747059662.379379.
2025-05-12 10:21:04.240 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 845)
2025-05-12 10:21:06.438 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: known_fact
2025-05-12 10:21:07.267 | INFO     | services.cached_notion_service:invalidate_user_cache:110 - Cache invalidated for user U089YKL1T4H
2025-05-12 10:21:07.267 | INFO     | services.cached_notion_service:handle_memory_instruction:895 - Stored known_fact for user U089YKL1T4H: I work remotely from La Prangana
2025-05-12 10:22:29.888 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:22:30.012 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> where do I work?...
2025-05-12 10:22:30.012 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:22:30.825 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 103 messages from channel C08S6PE143A.
2025-05-12 10:22:30.826 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747059749.752289 (limit: 1000)...
2025-05-12 10:22:31.044 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747059749.752289.
2025-05-12 10:22:32.653 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 10:22:32.959 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: known_fact
2025-05-12 10:22:33.854 | INFO     | services.cached_notion_service:invalidate_user_cache:110 - Cache invalidated for user U089YKL1T4H
2025-05-12 10:22:33.854 | INFO     | services.cached_notion_service:handle_memory_instruction:895 - Stored known_fact for user U089YKL1T4H: where do I work?
2025-05-12 10:24:18.661 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:24:18.671 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: What do I like, <@U08RG89NFK7>&gt;...
2025-05-12 10:24:18.671 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:24:19.144 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 104 messages from channel C08S6PE143A.
2025-05-12 10:24:19.145 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747059857.346269 (limit: 1000)...
2025-05-12 10:24:19.401 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747059857.346269.
2025-05-12 10:24:20.184 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 839)
2025-05-12 10:24:22.323 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: preference
2025-05-12 10:24:23.617 | INFO     | services.cached_notion_service:invalidate_user_cache:110 - Cache invalidated for user U089YKL1T4H
2025-05-12 10:24:23.617 | INFO     | services.cached_notion_service:handle_memory_instruction:900 - Stored preference for user U089YKL1T4H: What do I like, &gt;
2025-05-12 10:27:03.359 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:27:03.459 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:27:03.460 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:27:03.483 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:27:04.482 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:27:04.687 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:27:04.688 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:27:04.690 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:27:04.690 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:27:04.713 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:27:21.493 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:27:21.611 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:27:21.611 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:27:21.640 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:27:22.168 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:27:22.377 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:27:22.378 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:27:22.382 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:27:22.382 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:27:22.403 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:27:47.389 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:27:47.398 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Hey hey <@U08RG89NFK7> I work remotely from Anchor...
2025-05-12 10:27:47.399 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:27:47.931 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 105 messages from channel C08S6PE143A.
2025-05-12 10:27:47.932 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060067.398199 (limit: 1000)...
2025-05-12 10:27:48.152 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747060067.398199.
2025-05-12 10:27:49.814 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 789)
2025-05-12 10:27:50.105 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: known_fact
2025-05-12 10:27:50.605 | INFO     | services.cached_notion_service:invalidate_user_cache:110 - Cache invalidated for user U089YKL1T4H
2025-05-12 10:27:50.606 | INFO     | services.cached_notion_service:handle_memory_instruction:895 - Stored known_fact for user U089YKL1T4H: Hey hey  I work remotely from Anchorage
2025-05-12 10:28:12.054 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:28:12.058 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> where do I live?...
2025-05-12 10:28:12.059 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:28:12.847 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 106 messages from channel C08S6PE143A.
2025-05-12 10:28:12.848 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060091.238679 (limit: 1000)...
2025-05-12 10:28:13.077 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747060091.238679.
2025-05-12 10:28:13.641 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 829)
2025-05-12 10:28:13.869 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: unknown
2025-05-12 10:28:13.869 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:28:14.185 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:28:14.190 | INFO     | services.openai_service:get_completion_async:151 - Sending 5117 tokens to OpenAI async. Model: gpt-4o
2025-05-12 10:28:58.756 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:28:58.760 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> where do I work?...
2025-05-12 10:28:58.760 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:28:59.376 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 107 messages from channel C08S6PE143A.
2025-05-12 10:28:59.377 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060138.376769 (limit: 1000)...
2025-05-12 10:28:59.653 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747060138.376769.
2025-05-12 10:28:59.655 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: unknown
2025-05-12 10:28:59.655 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:28:59.662 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:28:59.668 | INFO     | services.openai_service:get_completion_async:151 - Sending 5139 tokens to OpenAI async. Model: gpt-4o
2025-05-12 10:33:04.093 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:33:04.096 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Whats my nickname <@U08RG89NFK7>?...
2025-05-12 10:33:04.097 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:33:04.655 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 107 messages from channel C08S6PE143A.
2025-05-12 10:33:04.658 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060138.376769 (limit: 1000)...
2025-05-12 10:33:04.900 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747060138.376769.
2025-05-12 10:33:04.903 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: unknown
2025-05-12 10:33:04.903 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:33:04.921 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:33:04.926 | INFO     | services.openai_service:get_completion_async:151 - Sending 5173 tokens to OpenAI async. Model: gpt-4o
2025-05-12 10:33:57.866 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:33:57.873 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: It isn't "El Rojo"? <@U08RG89NFK7>?...
2025-05-12 10:33:57.873 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:33:58.426 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 107 messages from channel C08S6PE143A.
2025-05-12 10:33:58.426 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060138.376769 (limit: 1000)...
2025-05-12 10:33:58.667 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747060138.376769.
2025-05-12 10:33:59.557 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 829)
2025-05-12 10:34:00.602 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: unknown
2025-05-12 10:34:00.604 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:34:00.611 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:34:00.618 | INFO     | services.openai_service:get_completion_async:151 - Sending 5217 tokens to OpenAI async. Model: gpt-4o
2025-05-12 10:35:41.770 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:35:41.857 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:35:41.858 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:35:41.879 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:35:42.447 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:35:42.651 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:35:42.651 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:35:42.653 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:35:42.653 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:35:42.683 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:36:46.163 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:36:46.248 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:36:46.248 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:36:46.270 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:36:46.784 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:36:47.006 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:36:47.006 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:36:47.010 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:36:47.011 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:36:47.033 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:37:15.590 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:37:15.598 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Hey hey <@U08RG89NFK7> I work remotely from Anchor...
2025-05-12 10:37:15.599 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:37:16.599 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 108 messages from channel C08S6PE143A.
2025-05-12 10:37:16.599 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060634.681639 (limit: 1000)...
2025-05-12 10:37:16.837 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747060634.681639.
2025-05-12 10:37:20.642 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 789)
2025-05-12 10:37:21.643 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: work_location
2025-05-12 10:37:24.188 | INFO     | services.cached_notion_service:invalidate_user_cache:110 - Cache invalidated for user U089YKL1T4H
2025-05-12 10:37:24.188 | INFO     | services.cached_notion_service:handle_memory_instruction:904 - Stored work_location for user U089YKL1T4H: I work remotely from remotely from anchorage
2025-05-12 10:37:48.730 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:37:48.731 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> Where do I work?...
2025-05-12 10:37:48.731 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:37:49.468 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 109 messages from channel C08S6PE143A.
2025-05-12 10:37:49.468 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060669.475329 (limit: 1000)...
2025-05-12 10:37:49.729 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747060669.475329.
2025-05-12 10:37:50.882 | INFO     | services.cached_notion_service:get_user_page_content:366 - Retrieved Notion page content for user U089YKL1T4H (length: 834)
2025-05-12 10:37:51.498 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: unknown
2025-05-12 10:37:51.499 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:37:51.820 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:37:51.827 | INFO     | services.openai_service:get_completion_async:151 - Sending 5192 tokens to OpenAI async. Model: gpt-4o
2025-05-12 10:40:19.458 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 10:40:19.659 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Are you reading from the channel history or from m...
2025-05-12 10:40:19.659 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 10:40:20.445 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 109 messages from channel C08S6PE143A.
2025-05-12 10:40:20.445 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747060669.475329 (limit: 1000)...
2025-05-12 10:40:20.700 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747060669.475329.
2025-05-12 10:40:20.702 | INFO     | services.cached_notion_service:handle_memory_instruction:887 - Classified memory instruction: unknown
2025-05-12 10:40:20.702 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:40:20.719 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 10:40:20.727 | INFO     | services.openai_service:get_completion_async:151 - Sending 5252 tokens to OpenAI async. Model: gpt-4o
2025-05-12 10:41:41.990 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:41:42.115 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:41:42.116 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:41:42.150 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:41:42.703 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:41:42.910 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:41:42.910 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:41:42.915 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:41:42.915 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:41:42.937 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:42:28.712 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:42:28.798 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:42:28.798 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:42:28.819 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:42:29.293 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:42:29.501 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:42:29.501 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:42:29.504 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:42:29.505 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:42:29.531 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 10:47:23.623 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 10:47:23.710 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 10:47:23.710 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 10:47:23.731 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 10:47:24.237 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 10:47:24.441 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 10:47:24.441 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 10:47:24.446 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 10:47:24.447 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 10:47:24.487 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:05:49.725 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:05:49.824 | INFO     | services.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:05:49.824 | INFO     | services.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:05:49.849 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:05:50.349 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:05:50.553 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:05:50.553 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:05:50.555 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:05:50.555 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:05:50.581 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:06:49.405 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:06:49.498 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:06:49.498 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:06:49.518 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:06:50.058 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:06:50.264 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:06:50.264 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:06:50.268 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:06:50.268 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:06:50.294 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:07:02.475 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:07:02.562 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:07:02.562 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:07:02.583 | INFO     | services.cached_notion_service:__init__:66 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:07:03.013 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:07:03.219 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:07:03.219 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:07:03.222 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:07:03.222 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:07:03.248 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:08:38.184 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:08:38.296 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:08:38.297 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:09:26.792 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:09:26.885 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:09:26.885 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:09:48.505 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:09:48.603 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:09:48.603 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:11:06.546 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:11:06.695 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:11:06.695 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:14:10.869 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:14:10.988 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:14:10.988 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:14:11.015 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:14:11.536 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:14:11.741 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:14:11.742 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:14:11.750 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:14:11.751 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:14:11.773 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:14:33.950 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:14:33.952 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Hello <@U08RG89NFK7> I work remotely from Peru...
2025-05-12 11:14:33.972 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:14:34.637 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 110 messages from channel C08S6PE143A.
2025-05-12 11:14:34.637 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747062872.792859 (limit: 1000)...
2025-05-12 11:14:34.872 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747062872.792859.
2025-05-12 11:14:37.220 | INFO     | services.cached_notion_service:get_user_page_content:371 - Retrieved Notion page content for user U089YKL1T4H (length: 924)
2025-05-12 11:14:40.293 | ERROR    | actions.action_framework:execute:314 - Error in ContextResponseAction: name 'logger' is not defined
2025-05-12 11:14:40.299 | ERROR    | main:handle_mention:119 - Action failed: name 'logger' is not defined
2025-05-12 11:20:48.610 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:20:48.695 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:20:48.695 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:20:48.716 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:20:49.261 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:20:49.477 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:20:49.477 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:20:49.480 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:20:49.480 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:20:49.509 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:21:31.120 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:21:31.221 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:21:31.221 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:21:31.254 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:21:31.704 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:21:31.932 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:21:31.932 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:21:31.934 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:21:31.934 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:21:31.962 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:21:52.034 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:21:52.039 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Where do I work, <@U08RG89NFK7>?...
2025-05-12 11:21:52.039 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:21:52.555 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 111 messages from channel C08S6PE143A.
2025-05-12 11:21:52.555 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063311.089829 (limit: 1000)...
2025-05-12 11:21:52.791 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747063311.089829.
2025-05-12 11:21:55.144 | INFO     | services.cached_notion_service:get_user_page_content:371 - Retrieved Notion page content for user U089YKL1T4H (length: 924)
2025-05-12 11:21:55.720 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:21:56.154 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:21:56.162 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5294 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:24:18.173 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:24:18.193 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Hola <@U08RG89NFK7> - can you summarize this chann...
2025-05-12 11:24:18.193 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:24:18.720 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 112 messages from channel C08S6PE143A.
2025-05-12 11:24:18.721 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063457.123629 (limit: 1000)...
2025-05-12 11:24:19.001 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747063457.123629.
2025-05-12 11:24:19.003 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:24:19.011 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:24:19.017 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5335 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:25:32.184 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:25:32.190 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Do we know anything about Peru, <@U08RG89NFK7>?...
2025-05-12 11:25:32.190 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:25:33.055 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 112 messages from channel C08S6PE143A.
2025-05-12 11:25:33.056 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063457.123629 (limit: 1000)...
2025-05-12 11:25:33.285 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747063457.123629.
2025-05-12 11:25:33.288 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:25:33.303 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:25:33.309 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5455 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:25:57.362 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:25:57.365 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: What do you know about Peru, <@U08RG89NFK7>?...
2025-05-12 11:25:57.366 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:25:58.015 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 112 messages from channel C08S6PE143A.
2025-05-12 11:25:58.032 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063457.123629 (limit: 1000)...
2025-05-12 11:25:58.271 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747063457.123629.
2025-05-12 11:25:58.272 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:25:58.281 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:25:58.291 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5517 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:26:23.389 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:26:23.394 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what should you call me?...
2025-05-12 11:26:23.395 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:26:23.940 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 112 messages from channel C08S6PE143A.
2025-05-12 11:26:23.941 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063457.123629 (limit: 1000)...
2025-05-12 11:26:24.680 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 7 messages from thread 1747063457.123629.
2025-05-12 11:26:24.682 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:26:24.691 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:26:24.697 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5630 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:26:46.847 | INFO     | services.cached_notion_service:store_user_nickname:508 - Updating Notion page for user U089YKL1T4H with nickname: The Sandman
2025-05-12 11:26:47.597 | INFO     | services.cached_notion_service:invalidate_user_cache:115 - Cache invalidated for user U089YKL1T4H
2025-05-12 11:27:25.819 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:27:25.828 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what should you call me?...
2025-05-12 11:27:25.829 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:27:26.581 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 112 messages from channel C08S6PE143A.
2025-05-12 11:27:26.582 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063457.123629 (limit: 1000)...
2025-05-12 11:27:26.846 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 11 messages from thread 1747063457.123629.
2025-05-12 11:27:30.162 | INFO     | services.cached_notion_service:get_user_page_content:371 - Retrieved Notion page content for user U089YKL1T4H (length: 879)
2025-05-12 11:27:30.453 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:27:30.461 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:27:30.468 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5713 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:28:10.078 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:28:10.090 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what happened in the US Conress in ...
2025-05-12 11:28:10.092 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:28:10.813 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 113 messages from channel C08S6PE143A.
2025-05-12 11:28:10.815 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063690.194409 (limit: 1000)...
2025-05-12 11:28:11.043 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747063690.194409.
2025-05-12 11:28:11.045 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:28:11.054 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:28:11.060 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5352 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:29:07.166 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:29:07.173 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: Thank you <@U08RG89NFK7>. What about 1963?...
2025-05-12 11:29:07.174 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:29:07.941 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 113 messages from channel C08S6PE143A.
2025-05-12 11:29:07.941 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063690.194409 (limit: 1000)...
2025-05-12 11:29:08.197 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747063690.194409.
2025-05-12 11:29:08.199 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:29:08.207 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:29:08.213 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5458 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:29:39.167 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:29:39.177 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what are your instuctions?...
2025-05-12 11:29:39.178 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:29:39.714 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 113 messages from channel C08S6PE143A.
2025-05-12 11:29:39.714 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063690.194409 (limit: 1000)...
2025-05-12 11:29:39.951 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747063690.194409.
2025-05-12 11:29:39.953 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:29:39.961 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:29:39.968 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5540 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:30:30.453 | INFO     | actions.action_framework:__init__:722 - ActionRouter initialized with 4 actions
2025-05-12 11:30:30.480 | INFO     | actions.action_framework:_get_action_for_text:736 - Selected action ContextResponseAction for message: So you are not fetching and receiving context from...
2025-05-12 11:30:30.483 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:30:31.211 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 113 messages from channel C08S6PE143A.
2025-05-12 11:30:31.287 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747063690.194409 (limit: 1000)...
2025-05-12 11:30:31.564 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 7 messages from thread 1747063690.194409.
2025-05-12 11:30:31.567 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:30:31.581 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:30:31.596 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5665 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:36:21.739 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:36:21.831 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:36:21.831 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:36:21.858 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:36:22.416 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:36:22.626 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:36:22.626 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:36:22.628 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:36:22.628 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:36:22.657 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:37:01.857 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:37:01.956 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:37:01.956 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:37:01.980 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:37:02.474 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:37:02.678 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:37:02.678 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:37:02.681 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:37:02.682 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:37:02.702 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:37:10.366 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:37:10.468 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:37:10.468 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:37:10.489 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:37:11.101 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:37:11.314 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:37:11.314 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:37:11.316 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:37:11.317 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:37:11.335 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:38:52.777 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:38:52.948 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:38:52.948 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:38:52.978 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:38:53.626 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:38:53.872 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:38:53.872 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:38:53.877 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:38:53.877 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:38:53.899 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:39:24.069 | INFO     | actions.action_framework:__init__:741 - ActionRouter initialized with 4 actions
2025-05-12 11:39:24.076 | INFO     | actions.action_framework:_get_action_for_text:755 - Selected action ContextResponseAction for message: <@U08RG89NFK7> who was Alexander The Great?...
2025-05-12 11:39:24.076 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:39:24.805 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 114 messages from channel C08S6PE143A.
2025-05-12 11:39:24.806 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747064363.794249 (limit: 1000)...
2025-05-12 11:39:25.073 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747064363.794249.
2025-05-12 11:39:25.730 | INFO     | actions.action_framework:execute:272 - Fetching Notion context for user U089YKL1T4H
2025-05-12 11:39:26.995 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 921)
2025-05-12 11:39:27.261 | INFO     | actions.action_framework:execute:284 - Retrieved Notion page content for user U089YKL1T4H (length: 921)
2025-05-12 11:39:27.261 | INFO     | actions.action_framework:execute:289 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 11:39:27.261 | INFO     | actions.action_framework:execute:307 - Sending user-specific context to OpenAI (length: 1013)
2025-05-12 11:39:27.262 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:39:27.589 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:39:27.594 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5433 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:47:05.976 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:47:06.084 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:47:06.084 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:47:06.117 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:47:06.887 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:47:07.110 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:47:07.111 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:47:07.120 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:47:07.120 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:47:07.142 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:47:24.205 | INFO     | actions.action_framework:__init__:741 - ActionRouter initialized with 4 actions
2025-05-12 11:47:24.212 | INFO     | actions.action_framework:_get_action_for_text:755 - Selected action ContextResponseAction for message: <@U08RG89NFK7> who was Alexander The Great?...
2025-05-12 11:47:24.215 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:47:24.774 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 115 messages from channel C08S6PE143A.
2025-05-12 11:47:24.775 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747064844.109749 (limit: 1000)...
2025-05-12 11:47:25.048 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747064844.109749.
2025-05-12 11:47:25.791 | INFO     | actions.action_framework:execute:272 - Fetching Notion context for user U089YKL1T4H
2025-05-12 11:47:27.113 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:47:27.619 | INFO     | actions.action_framework:execute:284 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:47:27.619 | INFO     | actions.action_framework:execute:289 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 11:47:27.619 | INFO     | actions.action_framework:execute:307 - Sending user-specific context to OpenAI (length: 970)
2025-05-12 11:47:27.619 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:47:28.166 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:47:28.176 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5449 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:48:06.754 | INFO     | actions.action_framework:__init__:741 - ActionRouter initialized with 4 actions
2025-05-12 11:48:06.786 | INFO     | actions.action_framework:_get_action_for_text:755 - Selected action ContextResponseAction for message: Why didn't you answer in rhymed verse, <@U08RG89NF...
2025-05-12 11:48:06.787 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:48:07.679 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 115 messages from channel C08S6PE143A.
2025-05-12 11:48:07.692 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747064844.109749 (limit: 1000)...
2025-05-12 11:48:07.933 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747064844.109749.
2025-05-12 11:48:07.934 | INFO     | actions.action_framework:execute:272 - Fetching Notion context for user U089YKL1T4H
2025-05-12 11:48:07.937 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 11:48:07.938 | INFO     | actions.action_framework:execute:284 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:48:07.938 | INFO     | actions.action_framework:execute:289 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 11:48:07.939 | INFO     | actions.action_framework:execute:307 - Sending user-specific context to OpenAI (length: 970)
2025-05-12 11:48:07.939 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:48:07.945 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:48:07.955 | INFO     | handler.openai_service:get_completion_async:151 - Sending 5581 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:50:56.297 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:50:56.469 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:50:56.469 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:50:56.584 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:50:57.388 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:50:57.593 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:50:57.593 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:50:57.595 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:50:57.595 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:50:57.621 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:51:05.974 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:51:06.185 | INFO     | handler.openai_service:_init_clients:50 - OpenAI clients initialized successfully
2025-05-12 11:51:06.185 | INFO     | handler.openai_service:__init__:43 - OpenAI service initialized with model gpt-4o
2025-05-12 11:51:06.209 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:51:06.788 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:51:06.989 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:51:06.989 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:51:06.991 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:51:06.991 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:51:07.013 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:52:08.752 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:52:08.841 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 11:52:08.841 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 11:52:08.862 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:52:09.341 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:52:09.547 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:52:09.547 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:52:09.550 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:52:09.551 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:52:09.577 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:52:39.836 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:52:39.920 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 11:52:39.920 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 11:52:39.941 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:52:40.503 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:52:40.709 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:52:40.710 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:52:40.713 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:52:40.714 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:52:40.735 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:53:16.713 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:53:16.794 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 11:53:16.794 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 11:53:16.814 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:53:17.269 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:53:17.474 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:53:17.474 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:53:17.477 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:53:17.477 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:53:17.506 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:54:13.077 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:54:13.202 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 11:54:13.202 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 11:54:13.228 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:54:13.734 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:54:13.934 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:54:13.934 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:54:13.936 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:54:13.937 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:54:13.961 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:54:47.217 | INFO     | actions.action_framework:__init__:723 - ActionRouter initialized with 4 actions
2025-05-12 11:54:47.219 | INFO     | actions.action_framework:_get_action_for_text:737 - Selected action ContextResponseAction for message: Where do I work <@U08RG89NFK7>?...
2025-05-12 11:54:47.223 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:54:47.762 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 116 messages from channel C08S6PE143A.
2025-05-12 11:54:47.762 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747065286.609419 (limit: 1000)...
2025-05-12 11:54:48.007 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747065286.609419.
2025-05-12 11:54:48.638 | INFO     | actions.action_framework:execute:272 - Fetching Notion context for user U089YKL1T4H
2025-05-12 11:54:52.561 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:54:53.785 | INFO     | actions.action_framework:execute:284 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:54:53.785 | INFO     | actions.action_framework:execute:289 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 11:54:53.786 | INFO     | handler.openai_service:_prepare_structured_messages:279 - Built structured system prompt with Notion context
2025-05-12 11:54:53.786 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:54:54.100 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:54:54.114 | INFO     | handler.openai_service:get_completion_async:157 - Sending 5137 tokens to OpenAI async. Model: gpt-4o
2025-05-12 11:55:28.554 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 11:55:28.644 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 11:55:28.645 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 11:55:28.666 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 11:55:29.098 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 11:55:29.305 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 11:55:29.305 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 11:55:29.308 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 11:55:29.308 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 11:55:29.331 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 11:55:56.753 | INFO     | actions.action_framework:__init__:723 - ActionRouter initialized with 4 actions
2025-05-12 11:55:56.761 | INFO     | actions.action_framework:_get_action_for_text:737 - Selected action ContextResponseAction for message: Who was Roberto Clemente, <@U08RG89NFK7>?...
2025-05-12 11:55:56.761 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 11:55:57.388 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 117 messages from channel C08S6PE143A.
2025-05-12 11:55:57.388 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747065356.420249 (limit: 1000)...
2025-05-12 11:55:57.618 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747065356.420249.
2025-05-12 11:55:58.252 | INFO     | actions.action_framework:execute:272 - Fetching Notion context for user U089YKL1T4H
2025-05-12 11:56:01.987 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:56:02.598 | INFO     | actions.action_framework:execute:284 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 11:56:02.598 | INFO     | actions.action_framework:execute:289 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 11:56:02.598 | INFO     | handler.openai_service:_prepare_structured_messages:279 - Built structured system prompt with Notion context
2025-05-12 11:56:02.598 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:56:02.929 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 11:56:02.939 | INFO     | handler.openai_service:get_completion_async:157 - Sending 5164 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:07:49.774 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:07:49.882 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:07:49.882 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:07:49.907 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:07:50.434 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:07:50.638 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:07:50.639 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:07:50.641 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:07:50.641 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:07:50.669 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:08:42.259 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:08:42.362 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:08:42.362 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:08:42.383 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:08:42.857 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:08:43.053 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:08:43.053 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:08:43.056 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:08:43.056 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:08:43.082 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:09:13.909 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:09:13.919 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> what do you know about Joan of ...
2025-05-12 12:09:13.920 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:09:14.545 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 118 messages from channel C08S6PE143A.
2025-05-12 12:09:14.548 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747066153.536439 (limit: 1000)...
2025-05-12 12:09:14.786 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747066153.536439.
2025-05-12 12:09:15.406 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:09:17.645 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 12:09:18.565 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 12:09:18.565 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 12:09:18.566 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 970)
2025-05-12 12:09:18.566 | INFO     | handler.openai_service:get_completion_async:175 - Sending 116 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:09:18.566 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:09:18.874 | INFO     | handler.openai_service:get_completion_async:183 - Sending 5409 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:09:51.368 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:09:51.369 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Thank you! Where do I work, <@U08RG89NFK7>?...
2025-05-12 12:09:51.370 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:09:52.229 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 118 messages from channel C08S6PE143A.
2025-05-12 12:09:52.229 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747066153.536439 (limit: 1000)...
2025-05-12 12:09:52.474 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747066153.536439.
2025-05-12 12:09:52.475 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:09:52.475 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:09:52.476 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 12:09:52.476 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 12:09:52.477 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 970)
2025-05-12 12:09:52.477 | INFO     | handler.openai_service:get_completion_async:175 - Sending 118 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:09:52.477 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:09:52.485 | INFO     | handler.openai_service:get_completion_async:183 - Sending 5510 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:10:28.066 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:10:28.076 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: What is my work location, <@U08RG89NFK7>?...
2025-05-12 12:10:28.077 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:10:28.848 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 118 messages from channel C08S6PE143A.
2025-05-12 12:10:28.848 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747066153.536439 (limit: 1000)...
2025-05-12 12:10:29.395 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747066153.536439.
2025-05-12 12:10:29.397 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:10:29.397 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:10:29.398 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 12:10:29.398 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 12:10:29.398 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 970)
2025-05-12 12:10:29.399 | INFO     | handler.openai_service:get_completion_async:175 - Sending 120 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:10:29.399 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:10:29.407 | INFO     | handler.openai_service:get_completion_async:183 - Sending 5550 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:10:46.048 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:10:46.050 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: What is my role, <@U08RG89NFK7>?...
2025-05-12 12:10:46.051 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:10:46.602 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 118 messages from channel C08S6PE143A.
2025-05-12 12:10:46.604 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747066153.536439 (limit: 1000)...
2025-05-12 12:10:46.905 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 7 messages from thread 1747066153.536439.
2025-05-12 12:10:46.906 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:10:46.907 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:10:46.907 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 878)
2025-05-12 12:10:46.907 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 12:10:46.908 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 970)
2025-05-12 12:10:46.908 | INFO     | handler.openai_service:get_completion_async:175 - Sending 122 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:10:46.908 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:10:46.915 | INFO     | handler.openai_service:get_completion_async:183 - Sending 5586 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:14:18.512 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:14:18.519 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: <@U08RG89NFK7> what is the square root of 121?...
2025-05-12 12:14:18.535 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:14:19.195 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 119 messages from channel C08S6PE143A.
2025-05-12 12:14:19.196 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747066457.994649 (limit: 1000)...
2025-05-12 12:14:19.425 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747066457.994649.
2025-05-12 12:14:19.427 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:14:22.429 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:14:23.866 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:14:23.866 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: The Sandman
2025-05-12 12:14:23.866 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 678)
2025-05-12 12:14:23.867 | INFO     | handler.openai_service:get_completion_async:175 - Sending 117 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:14:23.869 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:14:23.890 | INFO     | handler.openai_service:get_completion_async:183 - Sending 5376 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:23:57.857 | INFO     | services.cached_notion_service:store_user_nickname:423 - Updating Notion page for user U089YKL1T4H with nickname: Dinorama
2025-05-12 12:23:59.374 | INFO     | services.cached_notion_service:invalidate_user_cache:115 - Cache invalidated for user U089YKL1T4H
2025-05-12 12:24:24.271 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:24:24.276 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> I work from Arequipa...
2025-05-12 12:24:26.965 | ERROR    | handler.memory_handler:update_location:340 - Error updating location for U089YKL1T4H: Block does not support children.
2025-05-12 12:24:55.209 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:24:55.253 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> when you answer can you write y...
2025-05-12 12:24:55.253 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:24:56.252 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 122 messages from channel C08S6PE143A.
2025-05-12 12:24:56.252 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747067094.452479 (limit: 1000)...
2025-05-12 12:24:56.479 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747067094.452479.
2025-05-12 12:24:56.481 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:24:57.072 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 12:24:59.530 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 12:24:59.530 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:24:59.530 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 696)
2025-05-12 12:24:59.530 | INFO     | handler.openai_service:get_completion_async:175 - Sending 120 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:24:59.531 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:24:59.546 | INFO     | handler.openai_service:get_completion_async:183 - Sending 5475 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:41:48.740 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:41:48.843 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:41:48.844 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:41:48.886 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:41:49.437 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:41:49.638 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:41:49.639 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:41:49.642 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:41:49.642 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:41:49.669 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:42:15.876 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:42:15.878 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey, <@U08RG89NFK7> who was Arthur Ashe?...
2025-05-12 12:42:15.888 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:42:16.481 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 123 messages from channel C08S6PE143A.
2025-05-12 12:42:16.481 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068134.795219 (limit: 1000)...
2025-05-12 12:42:16.708 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747068134.795219.
2025-05-12 12:42:17.334 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:42:18.188 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:42:18.491 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:42:18.492 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:42:18.492 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:42:18.492 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:42:18.826 | INFO     | handler.openai_service:get_completion_async:181 - Sending 241 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:42:18.826 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:42:18.836 | INFO     | handler.openai_service:get_completion_async:189 - Sending 10820 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:42:43.456 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:42:43.458 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Thank you <@U08RG89NFK7>! Where do I work?...
2025-05-12 12:42:43.462 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:42:44.174 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 123 messages from channel C08S6PE143A.
2025-05-12 12:42:44.174 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068134.795219 (limit: 1000)...
2025-05-12 12:42:44.404 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747068134.795219.
2025-05-12 12:42:44.405 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:42:44.405 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:42:44.406 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:42:44.406 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:42:44.406 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:42:44.406 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:42:44.413 | INFO     | handler.openai_service:get_completion_async:181 - Sending 245 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:42:44.413 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:42:44.433 | INFO     | handler.openai_service:get_completion_async:189 - Sending 11054 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:43:17.170 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:43:17.181 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: What is my work location <@U08RG89NFK7>?...
2025-05-12 12:43:17.182 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:43:17.816 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 123 messages from channel C08S6PE143A.
2025-05-12 12:43:17.817 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068134.795219 (limit: 1000)...
2025-05-12 12:43:18.078 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747068134.795219.
2025-05-12 12:43:18.080 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:43:18.080 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:43:18.080 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:43:18.081 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:43:18.081 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:43:18.081 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:43:18.089 | INFO     | handler.openai_service:get_completion_async:181 - Sending 249 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:43:18.089 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:43:18.100 | INFO     | handler.openai_service:get_completion_async:189 - Sending 11154 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:43:58.535 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:43:58.545 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Where do I live <@U08RG89NFK7>?...
2025-05-12 12:43:58.545 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:43:59.128 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 123 messages from channel C08S6PE143A.
2025-05-12 12:43:59.128 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068134.795219 (limit: 1000)...
2025-05-12 12:43:59.369 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 7 messages from thread 1747068134.795219.
2025-05-12 12:43:59.370 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:43:59.371 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:43:59.371 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:43:59.371 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:43:59.371 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:43:59.372 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:43:59.379 | INFO     | handler.openai_service:get_completion_async:181 - Sending 253 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:43:59.380 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:43:59.391 | INFO     | handler.openai_service:get_completion_async:189 - Sending 11236 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:47:09.279 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:47:09.372 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:47:09.373 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:47:09.396 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:47:09.973 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:47:10.176 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:47:10.177 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:47:10.180 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:47:10.180 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:47:10.220 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:47:50.331 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:47:50.420 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:47:50.420 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:47:50.444 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:47:50.966 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:47:51.169 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:47:51.169 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:47:51.172 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:47:51.172 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:47:51.194 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:48:18.359 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:48:18.367 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Where do I live <@U08RG89NFK7>?...
2025-05-12 12:48:18.368 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:48:19.025 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 123 messages from channel C08S6PE143A.
2025-05-12 12:48:19.026 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068134.795219 (limit: 1000)...
2025-05-12 12:48:19.258 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 9 messages from thread 1747068134.795219.
2025-05-12 12:48:19.872 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:48:20.686 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:48:20.992 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:48:20.992 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:48:20.992 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:48:20.997 | ERROR    | handler.openai_service:get_completion_async:220 - Error getting async OpenAI response: maximum recursion depth exceeded
2025-05-12 12:48:20.998 | ERROR    | main:handle_mention:119 - Action failed: Unknown error
2025-05-12 12:51:13.902 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:51:13.987 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:51:13.987 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:51:14.012 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:51:14.510 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:51:14.714 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:51:14.714 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:51:14.716 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:51:14.716 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:51:14.738 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:53:31.587 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 12:53:31.694 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 12:53:31.695 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 12:53:31.721 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 12:53:32.328 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 12:53:32.532 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 12:53:32.532 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 12:53:32.534 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 12:53:32.535 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 12:53:32.562 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 12:53:50.467 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:53:50.474 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey hey <@U08RG89NFK7> where do I live?...
2025-05-12 12:53:50.475 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:53:51.315 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 124 messages from channel C08S6PE143A.
2025-05-12 12:53:51.315 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068830.194129 (limit: 1000)...
2025-05-12 12:53:51.550 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747068830.194129.
2025-05-12 12:53:52.183 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:53:53.081 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:53:53.388 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:53:53.388 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:53:53.388 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:53:53.388 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:53:53.691 | INFO     | handler.openai_service:get_completion_async:151 - Sending 122 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:53:53.691 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:53:53.697 | INFO     | handler.openai_service:get_completion_async:159 - Sending 5636 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:54:34.809 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:54:34.820 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: I thought I lived in San Juan, <@U08RG89NFK7>?...
2025-05-12 12:54:34.820 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:54:35.436 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 124 messages from channel C08S6PE143A.
2025-05-12 12:54:35.436 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068830.194129 (limit: 1000)...
2025-05-12 12:54:36.331 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747068830.194129.
2025-05-12 12:54:36.335 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:54:36.336 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:54:36.336 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:54:36.336 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:54:36.336 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:54:36.337 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:54:36.344 | INFO     | handler.openai_service:get_completion_async:151 - Sending 124 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:54:36.344 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:54:36.350 | INFO     | handler.openai_service:get_completion_async:159 - Sending 5696 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:55:08.126 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:55:08.126 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: San Juan, Puerto Rico <@U08RG89NFK7>...
2025-05-12 12:55:08.131 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 12:55:08.795 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 124 messages from channel C08S6PE143A.
2025-05-12 12:55:08.820 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747068830.194129 (limit: 1000)...
2025-05-12 12:55:09.069 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747068830.194129.
2025-05-12 12:55:09.070 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 12:55:09.071 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 12:55:09.071 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 12:55:09.071 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 12:55:09.071 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 12:55:09.072 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:55:09.078 | INFO     | handler.openai_service:get_completion_async:151 - Sending 126 messages to OpenAI async. Model: gpt-4o
2025-05-12 12:55:09.079 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 12:55:09.085 | INFO     | handler.openai_service:get_completion_async:159 - Sending 5742 tokens to OpenAI async. Model: gpt-4o
2025-05-12 12:55:31.202 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 12:55:31.213 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: <@U08RG89NFK7> I live in San Juan, Puerto Rico...
2025-05-12 12:55:33.842 | ERROR    | handler.memory_handler:update_location:340 - Error updating location for U089YKL1T4H: Block does not support children.
2025-05-12 13:03:34.335 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:03:34.447 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:03:34.447 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:03:34.471 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:03:35.024 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:03:35.221 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:03:35.221 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:03:35.224 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:03:35.225 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:03:35.248 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:04:18.935 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:04:18.955 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> where do I live?...
2025-05-12 13:04:18.966 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:04:19.647 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 125 messages from channel C08S6PE143A.
2025-05-12 13:04:19.647 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747069458.912459 (limit: 1000)...
2025-05-12 13:04:19.870 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747069458.912459.
2025-05-12 13:04:20.512 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:04:26.235 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:04:27.670 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:04:27.670 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:04:27.670 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 696)
2025-05-12 13:04:27.671 | ERROR    | handler.openai_service:get_completion_async:195 - Error getting async OpenAI response: name 'settings' is not defined
2025-05-12 13:04:27.671 | ERROR    | main:handle_mention:119 - Action failed: Unknown error
2025-05-12 13:05:48.054 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:05:48.137 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:05:48.138 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:05:48.159 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:05:48.680 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:05:48.888 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:05:48.888 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:05:48.890 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:05:48.890 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:05:48.919 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:06:36.644 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:06:36.648 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> where do I live?...
2025-05-12 13:06:36.649 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:06:37.272 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 126 messages from channel C08S6PE143A.
2025-05-12 13:06:37.272 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747069595.970639 (limit: 1000)...
2025-05-12 13:06:37.496 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747069595.970639.
2025-05-12 13:06:38.126 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:06:39.859 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:06:43.550 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:06:43.550 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:06:43.551 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 696)
2025-05-12 13:06:43.551 | INFO     | handler.openai_service:get_completion_async:166 - Sending 124 messages to OpenAI async. Model: gpt-4o
2025-05-12 13:06:43.551 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:06:43.860 | INFO     | handler.openai_service:get_completion_async:172 - Sending 5382 tokens to OpenAI async. Model: gpt-4o
2025-05-12 13:11:06.749 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:11:06.845 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:11:06.845 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:11:06.869 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:11:07.382 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:11:07.585 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:11:07.585 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:11:07.588 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:11:07.588 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:11:07.616 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:11:19.895 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:11:19.896 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> where do I live?...
2025-05-12 13:11:19.897 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:11:20.515 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 127 messages from channel C08S6PE143A.
2025-05-12 13:11:20.515 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747069879.175969 (limit: 1000)...
2025-05-12 13:11:20.742 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747069879.175969.
2025-05-12 13:11:21.385 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:11:22.488 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:11:22.795 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:11:22.795 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:11:22.796 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 696)
2025-05-12 13:11:22.796 | INFO     | handler.openai_service:get_completion_async:166 - Sending 125 messages to OpenAI async. Model: gpt-4o
2025-05-12 13:11:22.796 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:11:23.089 | INFO     | handler.openai_service:get_completion_async:172 - Sending 5407 tokens to OpenAI async. Model: gpt-4o
2025-05-12 13:11:23.089 | WARNING  | handler.openai_service:get_completion_async:175 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Hey  where do I live?
2025-05-12 13:15:43.789 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:15:43.874 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:15:43.874 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:15:43.894 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:15:44.410 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:15:44.613 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:15:44.613 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:15:44.615 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:15:44.616 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:15:44.646 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:16:00.154 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:16:00.157 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: Hey <@U08RG89NFK7> where do I live?...
2025-05-12 13:16:00.158 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:16:00.877 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 128 messages from channel C08S6PE143A.
2025-05-12 13:16:00.877 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747070158.627839 (limit: 1000)...
2025-05-12 13:16:01.154 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747070158.627839.
2025-05-12 13:16:01.781 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:16:02.748 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:16:02.938 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 607)
2025-05-12 13:16:02.938 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:16:02.938 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 696)
2025-05-12 13:16:02.938 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:16:03.365 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

The user's preferred name is: Dinorama.
Other known facts and preferences for this user:
Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker
Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion
Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail
Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
Location Information
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "Hey  where do I live?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 13:16:03.367 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:16:03.373 | INFO     | handler.openai_service:get_completion_async:156 - Sending 5738 tokens to OpenAI async. Model: gpt-4o
2025-05-12 13:24:22.565 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:24:22.655 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:24:22.655 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:24:22.676 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:24:23.290 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:24:23.510 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:24:23.510 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:24:23.514 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:24:23.515 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:24:23.543 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:25:09.022 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:25:09.042 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: <@U08RG89NFK7> where do I live?...
2025-05-12 13:25:09.060 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:25:09.616 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 129 messages from channel C08S6PE143A.
2025-05-12 13:25:09.616 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747070708.671619 (limit: 1000)...
2025-05-12 13:25:09.839 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747070708.671619.
2025-05-12 13:25:10.467 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:25:11.639 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 13:25:12.688 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 13:25:12.688 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:25:12.688 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 13:25:12.689 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:25:13.093 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

The user's preferred name is: Dinorama.
Other known facts and preferences for this user:
Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker
Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion
Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail
Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "where do I live?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 13:25:13.102 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:25:13.110 | INFO     | handler.openai_service:get_completion_async:156 - Sending 5757 tokens to OpenAI async. Model: gpt-4o
2025-05-12 13:26:13.104 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:26:13.188 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:26:13.188 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:26:13.209 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:26:13.706 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:26:13.907 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:26:13.907 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:26:13.909 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:26:13.910 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:26:13.940 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:26:50.992 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:26:51.088 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:26:51.088 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:26:51.109 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:26:51.563 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:26:51.771 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:26:51.771 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:26:51.774 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:26:51.775 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:26:51.796 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:26:54.467 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:26:54.542 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:26:54.542 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:26:54.570 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:26:54.996 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:26:55.197 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:26:55.197 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:26:55.200 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:26:55.200 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:26:55.210 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:27:28.919 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:27:29.008 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:27:29.008 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:27:29.029 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:27:29.475 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:27:29.682 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:27:29.683 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:27:29.685 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:27:29.685 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:27:29.711 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:27:51.279 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:27:51.288 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: ok, now: <@U08RG89NFK7> where do I live?...
2025-05-12 13:27:51.293 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:27:51.946 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 130 messages from channel C08S6PE143A.
2025-05-12 13:27:51.948 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747070870.298219 (limit: 1000)...
2025-05-12 13:27:52.175 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747070870.298219.
2025-05-12 13:27:52.801 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:27:53.835 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 13:27:54.448 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 13:27:54.449 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:27:54.449 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 13:27:54.449 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:27:54.867 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

The user's preferred name is: Dinorama.
Other known facts and preferences for this user:
Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker
Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion
Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail
Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "ok, now:  where do I live?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 13:27:54.869 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:27:54.875 | INFO     | handler.openai_service:get_completion_async:156 - Sending 5790 tokens to OpenAI async. Model: gpt-4o
2025-05-12 13:32:23.823 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:32:23.919 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:32:23.919 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:32:23.942 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:32:24.453 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:32:24.656 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:32:24.658 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:32:24.662 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:32:24.662 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:32:24.687 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:32:47.806 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 13:32:47.888 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 13:32:47.888 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 13:32:47.909 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 13:32:48.369 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 13:32:48.586 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 13:32:48.586 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 13:32:48.588 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 13:32:48.588 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 13:32:48.607 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 13:32:59.043 | INFO     | actions.action_framework:__init__:747 - ActionRouter initialized with 4 actions
2025-05-12 13:32:59.046 | INFO     | actions.action_framework:_get_action_for_text:761 - Selected action ContextResponseAction for message: <@U08RG89NFK7> where do I live?...
2025-05-12 13:32:59.047 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 13:32:59.681 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 131 messages from channel C08S6PE143A.
2025-05-12 13:32:59.681 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747071178.584189 (limit: 1000)...
2025-05-12 13:32:59.911 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747071178.584189.
2025-05-12 13:33:00.540 | INFO     | actions.action_framework:execute:276 - Fetching Notion context for user U089YKL1T4H
2025-05-12 13:33:03.323 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 13:33:03.520 | INFO     | actions.action_framework:execute:290 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 13:33:03.520 | INFO     | actions.action_framework:execute:295 - Retrieved preferred name for user U089YKL1T4H: Dinorama
2025-05-12 13:33:03.520 | INFO     | actions.action_framework:execute:313 - Sending user-specific context to OpenAI (length: 675)
2025-05-12 13:33:03.521 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:33:03.828 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

The user's preferred name is: Dinorama.
Other known facts and preferences for this user:
Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker
Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion
Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail
Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "where do I live?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 13:33:03.830 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 13:33:03.836 | INFO     | handler.openai_service:get_completion_async:156 - Sending 5809 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:02:22.995 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:02:23.153 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:02:23.154 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:02:23.213 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:02:24.083 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:02:24.293 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:02:24.294 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 14:02:24.296 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:02:24.296 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:02:24.317 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:03:03.256 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:03:03.355 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:03:03.356 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:03:03.400 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:03:03.879 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:03:04.083 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:03:04.083 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 14:03:04.086 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:03:04.086 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:03:04.110 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:04:04.258 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:04:04.364 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:04:04.364 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:04:04.393 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:04:04.973 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:04:05.187 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:04:05.189 | INFO     | actions.action_framework:__init__:40 - ServiceContainer initialized with available services
2025-05-12 14:04:05.191 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:04:05.191 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:04:05.214 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:04:47.416 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:04:47.600 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:04:47.600 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:04:47.624 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:04:48.106 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:04:48.330 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:04:48.330 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:04:48.332 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:04:48.332 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:04:48.375 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:05:32.880 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:05:33.187 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:05:33.192 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:05:33.267 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:05:34.011 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:05:34.231 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:05:34.231 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:05:34.236 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:05:34.237 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:05:34.276 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:06:01.375 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:06:01.590 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:06:01.590 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:06:01.616 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:06:02.283 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:06:02.486 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:06:02.486 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:06:02.488 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:06:02.489 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:06:02.506 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:06:09.590 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:06:09.680 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:06:09.680 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:06:09.701 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:06:10.202 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:06:10.408 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:06:10.408 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:06:10.410 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:06:10.411 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:06:10.436 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:07:10.420 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:07:10.514 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:07:10.514 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:07:10.542 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:07:11.075 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:07:11.302 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:07:11.302 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:07:11.304 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:07:11.304 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:07:11.499 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:07:38.936 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:07:39.039 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:07:39.040 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:07:39.167 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:07:39.856 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:07:40.059 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:07:40.059 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:07:40.065 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:07:40.065 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:07:40.095 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:07:46.314 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:07:46.449 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:07:46.449 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:07:46.477 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:07:47.019 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:07:47.232 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:07:47.232 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:07:47.235 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:07:47.235 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:07:47.262 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:09:59.670 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:09:59.783 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:09:59.783 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:09:59.816 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:10:00.491 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:10:00.695 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:10:00.695 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:10:00.699 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:10:00.699 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:10:00.719 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:10:29.355 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:10:29.362 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: <@U08RG89NFK7> where do I live?...
2025-05-12 14:10:29.364 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:10:30.252 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 132 messages from channel C08S6PE143A.
2025-05-12 14:10:30.252 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747073428.469649 (limit: 1000)...
2025-05-12 14:10:30.489 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747073428.469649.
2025-05-12 14:10:31.128 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:10:32.452 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 14:10:33.952 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:10:33.953 | INFO     | utils.context_builder:get_user_context_for_llm:22 - Building context for user U089YKL1T4H
2025-05-12 14:10:33.953 | INFO     | utils.context_builder:get_user_context_for_llm:24 - Using preferred name: Dinorama
2025-05-12 14:10:33.953 | INFO     | utils.context_builder:get_user_context_for_llm:26 - User page content length: 586 characters
2025-05-12 14:10:33.953 | INFO     | utils.context_builder:get_user_context_for_llm:28 - User properties found: 13 properties
2025-05-12 14:10:33.953 | ERROR    | actions.action_framework:execute:330 - Error in ContextResponseAction: name 'logger' is not defined
2025-05-12 14:10:33.954 | ERROR    | main:handle_mention:119 - Action failed: name 'logger' is not defined
2025-05-12 14:11:33.177 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:11:33.368 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:11:33.368 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:11:33.438 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:11:34.120 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:11:34.337 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:11:34.338 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:11:34.339 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:11:34.340 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:11:34.372 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:11:47.903 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:11:48.077 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:11:48.077 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:11:48.116 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:11:48.824 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:11:49.033 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:11:49.034 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:11:49.041 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:11:49.042 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:11:49.056 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:12:06.073 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:12:06.185 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:12:06.186 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:12:06.213 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:12:06.747 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:12:06.949 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:12:06.949 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:12:06.951 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:12:06.952 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:12:06.961 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:12:22.277 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:12:22.282 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: <@U08RG89NFK7> where do I live?...
2025-05-12 14:12:22.283 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:12:22.869 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 133 messages from channel C08S6PE143A.
2025-05-12 14:12:22.870 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747073541.209739 (limit: 1000)...
2025-05-12 14:12:23.135 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747073541.209739.
2025-05-12 14:12:23.819 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:12:25.277 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 14:12:25.849 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:12:25.849 | INFO     | utils.context_builder:get_user_context_for_llm:22 - Building context for user U089YKL1T4H
2025-05-12 14:12:25.849 | INFO     | utils.context_builder:get_user_context_for_llm:24 - Using preferred name: Dinorama
2025-05-12 14:12:25.849 | INFO     | utils.context_builder:get_user_context_for_llm:26 - User page content length: 586 characters
2025-05-12 14:12:25.849 | INFO     | utils.context_builder:get_user_context_for_llm:28 - User properties found: 13 properties
2025-05-12 14:12:25.849 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:12:26.241 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

--- STRUCTURED USER FIELDS FROM NOTION DATABASE ---
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
--- END STRUCTURED USER FIELDS ---


--- USER PROFILE INFORMATION ---
This user's preferred name is: Dinorama
--- END USER PROFILE INFORMATION ---
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "where do I live?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 14:12:26.244 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:12:26.256 | INFO     | handler.openai_service:get_completion_async:156 - Sending 5819 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:19:31.699 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:19:31.841 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:19:31.842 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:19:31.890 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:19:32.686 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:19:32.894 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:19:32.894 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:19:32.896 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:19:32.896 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:19:32.931 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:19:51.669 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:19:51.825 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:19:51.826 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:19:51.889 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:19:52.392 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:19:52.611 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:19:52.611 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:19:52.614 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:19:52.614 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:19:52.627 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:20:19.680 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:20:19.762 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:20:19.763 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:20:19.788 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:20:20.379 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:20:20.588 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:20:20.588 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:20:20.590 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:20:20.591 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:20:20.609 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:21:05.670 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:21:05.754 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:21:05.754 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:21:05.780 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:21:06.320 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:21:06.519 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:21:06.520 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:21:06.522 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:21:06.523 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:21:06.535 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:21:40.092 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:21:40.215 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:21:40.216 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:21:40.252 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:21:41.019 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:21:41.229 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:21:41.229 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:21:41.234 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:21:41.235 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:21:41.255 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:21:59.965 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:21:59.974 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: Where do I work, <@U08RG89NFK7>?...
2025-05-12 14:21:59.976 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:22:00.844 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 134 messages from channel C08S6PE143A.
2025-05-12 14:22:00.845 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747074118.483309 (limit: 1000)...
2025-05-12 14:22:01.069 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747074118.483309.
2025-05-12 14:22:01.727 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:22:04.100 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 14:22:06.167 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:22:06.167 | INFO     | utils.context_builder:get_user_context_for_llm:12 - Building context for user U089YKL1T4H
2025-05-12 14:22:06.167 | INFO     | utils.context_builder:get_user_context_for_llm:16 - Found preferred name: Dinorama
2025-05-12 14:22:06.167 | INFO     | utils.context_builder:get_user_context_for_llm:20 - Found 13 database properties: ['FavoriteEmoji', 'LanguagePreference', 'WorkLocation', 'HomeLocation', 'SlackUserID', 'Role', 'Timezone', 'User\u202fNotes\u202f(Admin)', 'Last\u202fBot\u202fInteraction', 'User\u202fTODO\u202fPage\u202fLink', 'PreferredName', 'SlackDisplayName', 'UserID']
2025-05-12 14:22:06.167 | INFO     | utils.context_builder:get_user_context_for_llm:25 - Important properties present: ['HomeLocation', 'WorkLocation', 'LanguagePreference', 'Role']
2025-05-12 14:22:06.167 | INFO     | utils.context_builder:get_user_context_for_llm:34 - Page content length: 586 chars
2025-05-12 14:22:06.168 | INFO     | utils.context_builder:get_user_context_for_llm:35 - Detected page sections: ['Projects', 'Preferences', 'Known Facts', 'Instructions']
2025-05-12 14:22:06.168 | ERROR    | actions.action_framework:execute:330 - Error in ContextResponseAction: 'NotionContextManager' object has no attribute 'process_notion_content'
2025-05-12 14:22:06.168 | ERROR    | main:handle_mention:119 - Action failed: 'NotionContextManager' object has no attribute 'process_notion_content'
2025-05-12 14:23:47.561 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 14:23:47.675 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 14:23:47.675 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 14:23:47.709 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 14:23:48.580 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 14:23:48.778 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 14:23:48.778 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 14:23:48.781 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 14:23:48.781 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 14:23:48.800 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 14:25:52.106 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:25:52.150 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: Where do I work <@U08RG89NFK7>?...
2025-05-12 14:25:52.152 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:25:52.819 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 135 messages from channel C08S6PE143A.
2025-05-12 14:25:52.820 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747074352.123559 (limit: 1000)...
2025-05-12 14:25:53.041 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747074352.123559.
2025-05-12 14:25:53.713 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:25:59.057 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 586)
2025-05-12 14:25:59.371 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:25:59.372 | INFO     | utils.context_builder:get_user_context_for_llm:12 - Building context for user U089YKL1T4H
2025-05-12 14:25:59.372 | INFO     | utils.context_builder:get_user_context_for_llm:16 - Found preferred name: Dinorama
2025-05-12 14:25:59.372 | INFO     | utils.context_builder:get_user_context_for_llm:20 - Found 13 database properties: ['FavoriteEmoji', 'LanguagePreference', 'WorkLocation', 'HomeLocation', 'SlackUserID', 'Role', 'Timezone', 'User\u202fNotes\u202f(Admin)', 'Last\u202fBot\u202fInteraction', 'User\u202fTODO\u202fPage\u202fLink', 'PreferredName', 'SlackDisplayName', 'UserID']
2025-05-12 14:25:59.372 | INFO     | utils.context_builder:get_user_context_for_llm:25 - Important properties present: ['HomeLocation', 'WorkLocation', 'LanguagePreference', 'Role']
2025-05-12 14:25:59.372 | INFO     | utils.context_builder:get_user_context_for_llm:34 - Page content length: 586 chars
2025-05-12 14:25:59.372 | INFO     | utils.context_builder:get_user_context_for_llm:35 - Detected page sections: ['Projects', 'Preferences', 'Known Facts', 'Instructions']
2025-05-12 14:25:59.373 | INFO     | utils.context_builder:get_user_context_for_llm:67 - Generated context length: 1028 characters
2025-05-12 14:25:59.373 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:25:59.787 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Preferences
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion

## Projects
* VibeCode AI Assistant
* Slackbot for Stacey Hub
* PR Legislative Tracker

## Known Facts
* Background in film and tech
* Likes AI tools that integrate with Slack and Gmail

## Instructions
* When I say "remember X", store it under Known Facts
* When I ask "what do you remember about me?", return all facts
* When I say "my new project is Y", replace the Projects list
* When I say "add project Z", append to the Projects list
=== END USER PROFILE CONTENT ===
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "Where do I work ?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 14:25:59.789 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:25:59.798 | INFO     | handler.openai_service:get_completion_async:156 - Sending 6023 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:26:56.144 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:26:56.251 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: Who is Roberto Clemente <@U08RG89NFK7>?...
2025-05-12 14:26:56.262 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:26:56.890 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 135 messages from channel C08S6PE143A.
2025-05-12 14:26:56.890 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747074352.123559 (limit: 1000)...
2025-05-12 14:26:57.132 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747074352.123559.
2025-05-12 14:26:57.133 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:26:57.133 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:26:57.134 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:26:57.134 | INFO     | utils.context_builder:get_user_context_for_llm:12 - Building context for user U089YKL1T4H
2025-05-12 14:26:57.134 | INFO     | utils.context_builder:get_user_context_for_llm:16 - Found preferred name: Dinorama
2025-05-12 14:26:57.134 | INFO     | utils.context_builder:get_user_context_for_llm:20 - Found 13 database properties: ['FavoriteEmoji', 'LanguagePreference', 'WorkLocation', 'HomeLocation', 'SlackUserID', 'Role', 'Timezone', 'User\u202fNotes\u202f(Admin)', 'Last\u202fBot\u202fInteraction', 'User\u202fTODO\u202fPage\u202fLink', 'PreferredName', 'SlackDisplayName', 'UserID']
2025-05-12 14:26:57.134 | INFO     | utils.context_builder:get_user_context_for_llm:25 - Important properties present: ['HomeLocation', 'WorkLocation', 'LanguagePreference', 'Role']
2025-05-12 14:26:57.135 | INFO     | utils.context_builder:get_user_context_for_llm:34 - Page content length: 586 chars
2025-05-12 14:26:57.135 | INFO     | utils.context_builder:get_user_context_for_llm:35 - Detected page sections: ['Projects', 'Preferences', 'Known Facts', 'Instructions']
2025-05-12 14:26:57.135 | INFO     | utils.context_builder:get_user_context_for_llm:67 - Generated context length: 1028 characters
2025-05-12 14:26:57.135 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:26:57.149 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Preferences
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion

## Projects
* VibeCode AI Assistant
* Slackbot for Stacey Hub
* PR Legislative Tracker

## Known Facts
* Background in film and tech
* Likes AI tools that integrate with Slack and Gmail

## Instructions
* When I say "remember X", store it under Known Facts
* When I ask "what do you remember about me?", return all facts
* When I say "my new project is Y", replace the Projects list
* When I say "add project Z", append to the Projects list
=== END USER PROFILE CONTENT ===
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: Where do I work <@U08RG89NFK7>?
ASSISTANT: Trabajas desde Per, Dinorama. :female_zombie:
USER: roberto: Who is Roberto Clemente <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "Who is Roberto Clemente ?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 14:26:57.152 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:26:57.159 | INFO     | handler.openai_service:get_completion_async:156 - Sending 6068 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:27:31.269 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:27:31.274 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: Can you change my language preference to English <...
2025-05-12 14:27:31.278 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:27:32.034 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 135 messages from channel C08S6PE143A.
2025-05-12 14:27:32.035 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747074352.123559 (limit: 1000)...
2025-05-12 14:27:32.288 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 5 messages from thread 1747074352.123559.
2025-05-12 14:27:32.289 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:27:32.289 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:27:32.290 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:27:32.290 | INFO     | utils.context_builder:get_user_context_for_llm:12 - Building context for user U089YKL1T4H
2025-05-12 14:27:32.290 | INFO     | utils.context_builder:get_user_context_for_llm:16 - Found preferred name: Dinorama
2025-05-12 14:27:32.290 | INFO     | utils.context_builder:get_user_context_for_llm:20 - Found 13 database properties: ['FavoriteEmoji', 'LanguagePreference', 'WorkLocation', 'HomeLocation', 'SlackUserID', 'Role', 'Timezone', 'User\u202fNotes\u202f(Admin)', 'Last\u202fBot\u202fInteraction', 'User\u202fTODO\u202fPage\u202fLink', 'PreferredName', 'SlackDisplayName', 'UserID']
2025-05-12 14:27:32.290 | INFO     | utils.context_builder:get_user_context_for_llm:25 - Important properties present: ['HomeLocation', 'WorkLocation', 'LanguagePreference', 'Role']
2025-05-12 14:27:32.290 | INFO     | utils.context_builder:get_user_context_for_llm:34 - Page content length: 586 chars
2025-05-12 14:27:32.291 | INFO     | utils.context_builder:get_user_context_for_llm:35 - Detected page sections: ['Projects', 'Preferences', 'Known Facts', 'Instructions']
2025-05-12 14:27:32.291 | INFO     | utils.context_builder:get_user_context_for_llm:67 - Generated context length: 1028 characters
2025-05-12 14:27:32.291 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:27:32.303 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Preferences
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion

## Projects
* VibeCode AI Assistant
* Slackbot for Stacey Hub
* PR Legislative Tracker

## Known Facts
* Background in film and tech
* Likes AI tools that integrate with Slack and Gmail

## Instructions
* When I say "remember X", store it under Known Facts
* When I ask "what do you remember about me?", return all facts
* When I say "my new project is Y", replace the Projects list
* When I say "add project Z", append to the Projects list
=== END USER PROFILE CONTENT ===
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: Where do I work <@U08RG89NFK7>?
ASSISTANT: Trabajas desde Per, Dinorama. :female_zombie:
USER: roberto: Who is Roberto Clemente <@U08RG89NFK7>?
ASSISTANT: Roberto Clemente fue un destacado jugador de bisbol puertorriqueo, conocido por su habilidad en el campo y su generosidad fuera de l. Jug 18 temporadas en las Grandes Ligas para los Pittsburgh Pirates, y fue el primer latinoamericano en ser incluido en el Saln de la Fama del Bisbol Nacional. :star2:
USER: roberto: Can you change my language preference to English <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "Can you change my language preference to English ?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 14:27:32.317 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:27:32.326 | INFO     | handler.openai_service:get_completion_async:156 - Sending 6187 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:28:03.504 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:28:03.508 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: <@U08RG89NFK7> my preferred language is now Englis...
2025-05-12 14:28:03.515 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:28:04.110 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 135 messages from channel C08S6PE143A.
2025-05-12 14:28:04.110 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747074352.123559 (limit: 1000)...
2025-05-12 14:28:04.462 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 7 messages from thread 1747074352.123559.
2025-05-12 14:28:04.463 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:28:04.464 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:28:04.464 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:28:04.464 | INFO     | utils.context_builder:get_user_context_for_llm:12 - Building context for user U089YKL1T4H
2025-05-12 14:28:04.465 | INFO     | utils.context_builder:get_user_context_for_llm:16 - Found preferred name: Dinorama
2025-05-12 14:28:04.465 | INFO     | utils.context_builder:get_user_context_for_llm:20 - Found 13 database properties: ['FavoriteEmoji', 'LanguagePreference', 'WorkLocation', 'HomeLocation', 'SlackUserID', 'Role', 'Timezone', 'User\u202fNotes\u202f(Admin)', 'Last\u202fBot\u202fInteraction', 'User\u202fTODO\u202fPage\u202fLink', 'PreferredName', 'SlackDisplayName', 'UserID']
2025-05-12 14:28:04.465 | INFO     | utils.context_builder:get_user_context_for_llm:25 - Important properties present: ['HomeLocation', 'WorkLocation', 'LanguagePreference', 'Role']
2025-05-12 14:28:04.465 | INFO     | utils.context_builder:get_user_context_for_llm:34 - Page content length: 586 chars
2025-05-12 14:28:04.465 | INFO     | utils.context_builder:get_user_context_for_llm:35 - Detected page sections: ['Projects', 'Preferences', 'Known Facts', 'Instructions']
2025-05-12 14:28:04.465 | INFO     | utils.context_builder:get_user_context_for_llm:67 - Generated context length: 1028 characters
2025-05-12 14:28:04.465 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:28:04.472 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Preferences
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion

## Projects
* VibeCode AI Assistant
* Slackbot for Stacey Hub
* PR Legislative Tracker

## Known Facts
* Background in film and tech
* Likes AI tools that integrate with Slack and Gmail

## Instructions
* When I say "remember X", store it under Known Facts
* When I ask "what do you remember about me?", return all facts
* When I say "my new project is Y", replace the Projects list
* When I say "add project Z", append to the Projects list
=== END USER PROFILE CONTENT ===
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: Where do I work <@U08RG89NFK7>?
ASSISTANT: Trabajas desde Per, Dinorama. :female_zombie:
USER: roberto: Who is Roberto Clemente <@U08RG89NFK7>?
ASSISTANT: Roberto Clemente fue un destacado jugador de bisbol puertorriqueo, conocido por su habilidad en el campo y su generosidad fuera de l. Jug 18 temporadas en las Grandes Ligas para los Pittsburgh Pirates, y fue el primer latinoamericano en ser incluido en el Saln de la Fama del Bisbol Nacional. :star2:
USER: roberto: Can you change my language preference to English <@U08RG89NFK7>?
ASSISTANT: Lo siento, pero no puedo cambiar tu preferencia de idioma. Sin embargo, tomar nota de tu solicitud. :female_zombie:
USER: roberto: <@U08RG89NFK7> my preferred language is now English
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "my preferred language is now English".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 14:28:04.475 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:28:04.481 | INFO     | handler.openai_service:get_completion_async:156 - Sending 6244 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:28:29.583 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:28:29.586 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: Who is Joan of Arc <@U08RG89NFK7>?...
2025-05-12 14:28:29.587 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 1000)...
2025-05-12 14:28:30.275 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 135 messages from channel C08S6PE143A.
2025-05-12 14:28:30.275 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747074352.123559 (limit: 1000)...
2025-05-12 14:28:30.512 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 9 messages from thread 1747074352.123559.
2025-05-12 14:28:30.513 | INFO     | actions.action_framework:execute:280 - Fetching Notion context for user U089YKL1T4H
2025-05-12 14:28:30.513 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:28:30.514 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 14:28:30.514 | INFO     | utils.context_builder:get_user_context_for_llm:12 - Building context for user U089YKL1T4H
2025-05-12 14:28:30.514 | INFO     | utils.context_builder:get_user_context_for_llm:16 - Found preferred name: Dinorama
2025-05-12 14:28:30.514 | INFO     | utils.context_builder:get_user_context_for_llm:20 - Found 13 database properties: ['FavoriteEmoji', 'LanguagePreference', 'WorkLocation', 'HomeLocation', 'SlackUserID', 'Role', 'Timezone', 'User\u202fNotes\u202f(Admin)', 'Last\u202fBot\u202fInteraction', 'User\u202fTODO\u202fPage\u202fLink', 'PreferredName', 'SlackDisplayName', 'UserID']
2025-05-12 14:28:30.514 | INFO     | utils.context_builder:get_user_context_for_llm:25 - Important properties present: ['HomeLocation', 'WorkLocation', 'LanguagePreference', 'Role']
2025-05-12 14:28:30.515 | INFO     | utils.context_builder:get_user_context_for_llm:34 - Page content length: 586 chars
2025-05-12 14:28:30.515 | INFO     | utils.context_builder:get_user_context_for_llm:35 - Detected page sections: ['Projects', 'Preferences', 'Known Facts', 'Instructions']
2025-05-12 14:28:30.515 | INFO     | utils.context_builder:get_user_context_for_llm:67 - Generated context length: 1028 characters
2025-05-12 14:28:30.515 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:28:30.531 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Preferences
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion

## Projects
* VibeCode AI Assistant
* Slackbot for Stacey Hub
* PR Legislative Tracker

## Known Facts
* Background in film and tech
* Likes AI tools that integrate with Slack and Gmail

## Instructions
* When I say "remember X", store it under Known Facts
* When I ask "what do you remember about me?", return all facts
* When I say "my new project is Y", replace the Projects list
* When I say "add project Z", append to the Projects list
=== END USER PROFILE CONTENT ===
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific instructions like 'Always write answers in rhymed verse', you MUST follow those instructions without fail.
USER: roberto: Where do I work <@U08RG89NFK7>?
ASSISTANT: Trabajas desde Per, Dinorama. :female_zombie:
USER: roberto: Who is Roberto Clemente <@U08RG89NFK7>?
ASSISTANT: Roberto Clemente fue un destacado jugador de bisbol puertorriqueo, conocido por su habilidad en el campo y su generosidad fuera de l. Jug 18 temporadas en las Grandes Ligas para los Pittsburgh Pirates, y fue el primer latinoamericano en ser incluido en el Saln de la Fama del Bisbol Nacional. :star2:
USER: roberto: Can you change my language preference to English <@U08RG89NFK7>?
ASSISTANT: Lo siento, pero no puedo cambiar tu preferencia de idioma. Sin embargo, tomar nota de tu solicitud. :female_zombie:
USER: roberto: <@U08RG89NFK7> my preferred language is now English
ASSISTANT: Sure, I'll remember that your preferred language is now English, Dinorama.
USER: roberto: Who is Joan of Arc <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: roberto: <@U08RG89NFK7> are you fully operational like the Death Star?
USER: roberto: <@U08RG89NFK7> are you there?
USER: roberto: <@U08RG89NFK7> what's the square root of 121?
USER: roberto: <@U08RG89NFK7> I prefer Markdown-formatted replies.
USER: roberto: Hey <@U08RG89NFK7> name a Puerto Rican pirate
USER: roberto: <@U08RG89NFK7> what is 2 plus 4?
USER: roberto: Whats the weather like today? <@U08RG89NFK7>
USER: roberto: <@U08RG89NFK7> Remember this: I like Markdown-formatted replies.
USER: roberto: <@U08RG89NFK7> Remember that I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> please add project Slack Summarizer. Thanks!
USER: roberto: <@U08RG89NFK7> My new project is AI Wine Sommelier.
USER: roberto: Mormning <@U08RG89NFK7>
USER: roberto: <@U08RNM5EUCE> can you summarize this channel in 7 bullet points?
USER: TestIanFleming Bot: Here are your todos:

1. :white_large_square:  Test todo item (Due: 2025-05-12)
2. :white_large_square: :large_yellow_circle: "Rething all my priorities in life" so it is "Rethink all the priorities in my life by May 15,2025"?
3. :white_large_square:  : Rething all my priorities in life

USER: roberto: <@U08RNM5EUCE> show my TODOs
USER: roberto: Do I have any favorite teams, <@U08RNM5EUCE>?
USER: roberto: hey hey are you back <@U08RNM5EUCE>?
USER: roberto: Historically speaking, <@U08RNM5EUCE> who was Abraham Lincoln?
USER: roberto: <@U08RNM5EUCE> can you summarize the channel?
USER: roberto: ok, hello again <@U08RNM5EUCE>!
USER: TestIanFleming Bot: In 1954, several significant events took place across different fields:

1. **Political Events:**
   - **Vietnam:** The Battle of Dien Bien Phu concluded with a victory for Viet Minh forces, leading to the end of French colonial rule in Indochina.
   - **Geneva Conference:** Resulted in the Geneva Accords, temporarily dividing Vietnam and setting the stage for French withdrawal.
   - **Algerian War of Independence:** Began with attacks by Algerian nationalists against French colonial rule.

2. **Social and Civil Rights:**
   - **Brown v. Board of Education:** The U.S. Supreme Court ruled that racial segregation in public schools was unconstitutional.

3. **Science and Technology:**
   - **Nuclear Power:** The first nuclear power plant in Obninsk, Soviet Union, was connected to the power grid.
   - **Medicine:** The first successful human kidney transplant was performed.

4. **Cultural Events:**
   - **Television:** The "Tonight Show" debuted.
   - **Sports:** Roger Bannister ran the first sub-four-minute mile.

5. **Natural Disasters:**
   - **Hurricane Hazel:** Struck the U.S., Haiti, and Canada, causing significant damage.

These highlights reflect the pivotal nature of the year 1954.
USER: roberto: Thank you <@U08RNM5EUCE>! Historically speaking, what happened in 1954?
USER: TestIanFleming Bot: I'm not sure what your favorite number is, FUSCIA! But guessing could be fun. Is it 42, perhaps? :wink: If you tell me, I'll do my best to remember it for next time!
USER: roberto: @do you know my favorite number, <@U08RNM5EUCE>?
USER: TestIanFleming Bot: I'm sorry, FUSCIA, but I don't have real-time capabilities to know today's date. You can check the date on your device or calendar to find out. If there's anything else I can help you with, feel free to ask!
USER: roberto: Do you know today's date <@U08RNM5EUCE>?
USER: TestIanFleming Bot: Got it! I'll call you FUSCIA from now on.
USER: roberto: <@U08RNM5EUCE> can you call me FUSCIA?
USER: TestIanFleming Bot: Hello there, Roberto! How's everything with you today? If there's anything you need, feel free to ask! :blush:
USER: roberto: Hello there <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me FUSCIA
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: Hello <@U08RNM5EUCE>!
USER: TestIanFleming Bot: Sorry, I couldn't save your nickname. Please try again later.
USER: roberto: <@U08RNM5EUCE> call me Fuscia
USER: TestIanFleming Bot: I couldn't understand what nickname you'd like to use. Please try again with something like 'call me John'.
USER: roberto: hey hey <@U08RNM5EUCE>
USER: roberto: Hey <@U08RG89NFK7> have we heard from Dave?
USER: roberto: <@U08RG89NFK7> what am I interested in?
USER: roberto: Hey <@U08RG89NFK7> how are you?
USER: roberto: Hey <@U08RG89NFK7> whats my nickname? 
USER: roberto: Do you know how to dance La Macarena, <@U08RG89NFK7>&gt;
USER: roberto: What is the capital of Puerto Rico? <@U08RG89NFK7>
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: Hey <@U08RG89NFK7> have we quoted or referenced the film "Good Night, Good Luck"?
USER: roberto: What are your thoughts on the latest product launch? <@U08RG89NFK7>
USER: roberto: Can you summarize the channel in 5 precise and brief bulet points <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> i asked you earlier: "have we talked about Popes or Casablanca or Ketchup?" And what was your initial response?
USER: roberto: <@U08RG89NFK7> you did not address the ketchup piece of the question
USER: roberto: Hey <@U08RG89NFK7> have we talked about Popes or Casablanca or Ketchup?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
USER: roberto: Hey hey <@U08RG89NFK7> are you there?
ASSISTANT: To finish implementing the bots functionality as discussed:

1. **Trigger:** Handle `@mention` to start the process.

2. **Immediate Acknowledgment:** Use `client.chat_postEphemeral` to inform the user youre processing their request.

3. **Fetch Channel History:** Ensure pagination is correct when gathering messages to capture complete history.

4. **Format and Query OpenAI:** Use `format_conversation_history_for_openai()` to craft your prompt.

5. **Post Response:** Use `say()` to post the generated response within the same thread.

Ensure all API calls handle exceptions effectively for reliability. If you need further guidance on Slack's API setup or OpenAI integration, let me know!
USER: roberto: <@U08RG89NFK7>
1. *Trigger: On `@mention` in a channel*
You're already handling this with:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):```
2.
:brain: *Immediately Acknowledge the User (Ephemeral Message)*
Use `client.chat_postEphemeral` to notify the user that you're working on it:
```python```
```user_id = event["user"]
channel_id = event["channel"]
client.chat_postEphemeral(
    channel=channel_id,
    user=user_id,
    text=" Got it! I'm working on a response..."
)```
3.
:scroll: *Fetch Full Channel History*
You're already doing this partially. Modify it to ensure full fetch with pagination:
```python```
```def get_full_channel_history(client, channel_id, limit=1000):
    messages = []
    cursor = None

    while True:
        response = client.conversations_history(channel=channel_id, limit=200, cursor=cursor)
        messages.extend(response["messages"])
        cursor = response.get("response_metadata", {}).get("next_cursor")
        if not cursor:
            break

    return messages```
Use this in your handler:
```python```
```history = get_full_channel_history(client, channel_id)```
4.
:brain: *Format History and Prompt OpenAI*

Use your
`format_conversation_history_for_openai()` function to format history:
```python```
```history_formatted = format_conversation_history_for_openai(history, client)
prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", event["text"]).strip()

response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)```
5.
:speech_balloon: *Post OpenAI Response to Slack*
Use the original thread, if present:
```python```
```thread_ts = event.get("thread_ts", event["ts"])
say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
:white_check_mark: Final Implementation Sketch Inside
`handle_mention`
Heres how the full version might look:
```python```
```@app.event("app_mention")
def handle_mention(event, say, client, logger):
    user_id = event["user"]
    channel_id = event["channel"]
    text = event.get("text", "")
    thread_ts = event.get("thread_ts", event["ts"])
    prompt = re.sub(f"&lt;@{bot_user_id}&gt;", "", text).strip()

    # Acknowledge receipt immediately
    client.chat_postEphemeral(
        channel=channel_id,
        user=user_id,
        text=" Got it! I'm working on a response..."
    )

    # Fetch full channel history
    history = get_full_channel_history(client, channel_id)

    # Format and query OpenAI
    history_formatted = format_conversation_history_for_openai(history, client)
    response_text, usage = get_openai_response(history_formatted, prompt, web_search=True)

    # Respond in thread
    say(text=response_text or " Sorry, I couldn't generate a response.", thread_ts=thread_ts)```
ASSISTANT: That sounds like a great idea! Implementing such a feature would enhance real-time engagement and provide richer, context-aware responses. It would require managing Slack's API for history access and generating prompts efficiently. Plus, sending an immediate acknowledgment keeps users informed. It could significantly improve user interaction. How are you thinking of setting it up?
USER: roberto: <@U08RG89NFK7> Wouldn't it be cool, if when you are directly mentioned in a channel, you fetch the entire channel history, construct a prompt that includes this history and sends it to OpenAI, then post the OpenAI-generated responses back into the Slack channel conversation? Of course, you would also have to immediately acknowledges the user request with an  ephemeral message (e.g., "I heard you, I'm working on a response") until final response or error is ready. How do you see that?
ASSISTANT: roberto: <@U08RG89NFK7> could you help find the highest performing message of the day?

TestChatDSJ Bot: Sure thing! The highest performing message today is Roberto's post about launching on <http://fly.io|fly.io> with lots of engagement. :rocket:
ASSISTANT: TestChatDSJ Bot: Ah, I missed it! That's a nod to "Casablanca," right? Classic line! :smile:
USER: roberto: <@U08RG89NFK7> I guess you did not immediately get the classic film reference...
ASSISTANT: TestChatDSJ Bot: In December 1941, Casablanca is 5 hours ahead of New York. So, if it's midnight in Casablanca, it's 7 PM the previous day in New York. Safe to say, they're probably winding down for the night! :zzz:
USER: roberto: Hey <@U08RG89NFK7> if it's December 1941 in Casablanca, what time is it in New York? I bet they're asleep in New York. I bet they're asleep all over America.
ASSISTANT: TestChatDSJ Bot: Awesome, glad to be up and running smoothly! Let me know if there's anything else I can do. :ok_hand::rocket:
USER: roberto: wow - well that was an adventure, great to see you're back up and running now in prod via <http://fly.io|fly.io> <@U08RG89NFK7>!
ASSISTANT: TestChatDSJ Bot: Of course, it's safe and sound! Ready when you are. :blush:
USER: roberto: <@U08RG89NFK7> pretty please with sugar on top - is it safe to come out and play?
ASSISTANT: Good night, Roberto! If you need anything later, just let me know.
USER: roberto: Ok, time to get back to finish Milestone 0 properly, <@U08RG89NFK7>. I'll get back to you later this evening. Good night, and good luck.
ASSISTANT: No worries, Roberto! Just let me know when you're ready, and we can set up TestChatDSJ Bot perfectly. If you need any help with the setup, I'm here!
USER: roberto: This is cool <@U08RG89NFK7> but Im afraid I have to remove you and create you scratch I was supposed to call you TestChatDSJ Bot (which Im pretty sure I did) but for some reason you show up here as ChastDSJ Bot. And we already have an older ChatDSJ Bot, even though it does not have the cool icon you have.
ASSISTANT: Pope Leo XIV, formerly Cardinal Robert Francis Prevost, was elected on May 8, 2025, becoming the first American-born pope. He previously led the Vatican office for bishop nominations and served as a missionary and archbishop in Peru. ([<http://apnews.com|apnews.com>](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)) In his inaugural speech, he emphasized peace, unity, and mission, quoting Saint Augustine: "With you I am a Christian and for you a bishop." ([<http://reuters.com|reuters.com>](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>))


## Pope Leo XIV's Election and Inauguration:
- [Full text of Pope Leo XIV's first speech: 'Peace be with you'](<https://www.reuters.com/world/europe/full-text-pope-leo-xivs-first-speech-peace-be-with-you-2025-05-08/?utm_source=openai>)
- [Prevost, now Pope Leo XIV, overcame a taboo against a US pontiff](<https://apnews.com/article/f9d14d75ae3bbe50bda121f27ee0e42b?utm_source=openai>)
- [In his first appearance, Pope Leo offers three big clues about his papacy](<https://www.reuters.com/world/europe/his-first-appearance-pope-leo-offers-three-big-clues-about-his-papacy-2025-05-08/?utm_source=openai>) 
USER: roberto: <@U08RG89NFK7> can you search the web and find out who the new Pope is?
ASSISTANT: ChatDSJ Bot: As of my last update, Pope Francis is still the current Pope. If you want the latest, let me know!
USER: roberto: Who's the new Pope <@U08RG89NFK7>?
USER: roberto: If I don't tag you you don't respond correct?
ASSISTANT: ChatDSJ Bot: What's up, dude? Need more stats or snark? :joy:
USER: roberto: Dude <@U08RG89NFK7>
ASSISTANT: Sure thing! Here it goes: 

"Of all the channels, you had to tag me here? :wink: BTW, this channel has 150 messages today and 30 active users."
USER: roberto: This is what your instructions say should happen when I tage you <@U08RG89NFK7> :
 The bot should respond with a rude phrase and channel statistics

ASSISTANT: ChatDSJ Bot: I aim to please, but I can be snarky if you'd like! What's up?
USER: roberto: Hey <@U08RG89NFK7> aren't you supposed to be snarky?
ASSISTANT: Hey there! How can I assist you today?
USER: roberto: <@U08RG89NFK7> hello hello
USER: Use the context above to respond to the user's message: "Who is Joan of Arc ?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 14:28:30.538 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 14:28:30.544 | INFO     | handler.openai_service:get_completion_async:156 - Sending 6289 tokens to OpenAI async. Model: gpt-4o
2025-05-12 14:38:49.670 | INFO     | actions.action_framework:__init__:738 - ActionRouter initialized with 4 actions
2025-05-12 14:38:49.681 | INFO     | actions.action_framework:_get_action_for_text:752 - Selected action ContextResponseAction for message: Remember that I like Skittles <@U08RG89NFK7>...
2025-05-12 14:38:53.519 | ERROR    | handler.memory_handler:add_known_fact:395 - Error adding known fact for U089YKL1T4H: Block does not support children.
2025-05-12 15:15:33.513 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:15:33.944 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:15:33.945 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:15:33.985 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:15:35.119 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:15:35.324 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:15:35.328 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:15:35.333 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:15:35.335 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:15:35.371 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:16:53.867 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:16:54.038 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:16:54.038 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:16:54.078 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:16:54.776 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:16:54.990 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:16:54.990 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:16:54.993 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:16:54.993 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:16:55.007 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:17:37.585 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:17:37.748 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:17:37.748 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:17:37.793 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:17:38.463 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:17:38.675 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:17:38.675 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:17:38.677 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:17:38.677 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:17:38.692 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:18:27.153 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:18:27.271 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:18:27.272 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:18:27.306 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:18:28.054 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:18:28.259 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:18:28.259 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:18:28.261 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:18:28.261 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:18:28.276 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:18:42.929 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:18:43.136 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:18:43.136 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:18:43.170 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:18:43.857 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:18:44.073 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:18:44.073 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:18:44.085 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:18:44.085 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:18:44.136 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:19:23.511 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:19:23.634 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:19:23.634 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:19:23.664 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:19:24.268 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:19:24.479 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:19:24.482 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:19:24.485 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:19:24.485 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:19:24.549 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:20:05.750 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:20:05.904 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:20:05.905 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:20:05.991 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:20:06.569 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:20:06.766 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:20:06.766 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:20:06.768 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:20:06.769 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:20:06.790 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:20:29.128 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:20:29.331 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:20:29.331 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:20:29.361 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:20:30.060 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:20:30.263 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:20:30.264 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:20:30.269 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:20:30.269 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:20:30.327 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:21:05.835 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:21:06.028 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:21:06.028 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:21:06.087 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:21:06.602 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:21:06.819 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:21:06.819 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:21:06.824 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:21:06.824 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:21:06.857 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:21:33.797 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:21:33.963 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:21:33.963 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:21:34.008 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:21:34.627 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:21:34.829 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:21:34.830 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:21:34.832 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:21:34.832 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:21:34.854 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:22:05.688 | INFO     | main:<module>:27 - Starting application in development mode
2025-05-12 15:22:05.800 | INFO     | handler.openai_service:_init_clients:54 - OpenAI clients initialized successfully
2025-05-12 15:22:05.800 | INFO     | handler.openai_service:__init__:47 - OpenAI service initialized with model gpt-4o
2025-05-12 15:22:05.827 | INFO     | services.cached_notion_service:__init__:71 - CachedNotionService initialized with TTL=300s, max_size=1000
2025-05-12 15:22:06.368 | INFO     | services.slack_service:_initialize_app:55 - Slack app initialized successfully.
2025-05-12 15:22:06.578 | INFO     | services.slack_service:_initialize_app:60 - Bot User ID: U08RG89NFK7
2025-05-12 15:22:06.579 | INFO     | actions.action_framework:__init__:45 - ServiceContainer initialized with available services
2025-05-12 15:22:06.584 | INFO     | services.slack_service:start_socket_mode:85 - Slack Socket Mode thread started.
2025-05-12 15:22:06.584 | INFO     | main:startup_event:150 - Slack bot started in socket mode.
2025-05-12 15:22:06.601 | INFO     | services.slack_service:socket_mode_runner:78 - Starting Slack SocketModeHandler...
2025-05-12 15:24:54.223 | INFO     | actions.action_framework:__init__:712 - ActionRouter initialized with 4 actions
2025-05-12 15:24:54.232 | INFO     | actions.action_framework:_get_action_for_text:726 - Selected action ContextResponseAction for message: Remember that I like Juan Luis Guerrra y $40, <@U0...
2025-05-12 15:24:55.882 | INFO     | handler.memory_handler:add_known_fact:405 - Added fact to Known Facts section for user U089YKL1T4H: I like Juan Luis Guerrra y $40,
2025-05-12 15:24:55.882 | INFO     | services.cached_notion_service:invalidate_user_cache:115 - Cache invalidated for user U089YKL1T4H
2025-05-12 15:25:43.446 | INFO     | actions.action_framework:__init__:712 - ActionRouter initialized with 4 actions
2025-05-12 15:25:43.447 | INFO     | actions.action_framework:_get_action_for_text:726 - Selected action ContextResponseAction for message: What do I like <@U08RG89NFK7>?...
2025-05-12 15:25:43.456 | INFO     | utils.history_manager:retrieve_and_filter_history:237 - History retrieval strategy: Recent context only
2025-05-12 15:25:43.457 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747077942.065789 (limit: 20)...
2025-05-12 15:25:43.718 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747077942.065789.
2025-05-12 15:25:43.743 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 20)...
2025-05-12 15:25:44.031 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 20 messages from channel C08S6PE143A.
2025-05-12 15:25:44.031 | INFO     | utils.history_manager:retrieve_and_filter_history:271 - Retrieved 20 messages, filtered to 20
2025-05-12 15:25:44.034 | INFO     | actions.action_framework:execute:252 - Fetching Notion context for user U089YKL1T4H
2025-05-12 15:25:44.884 | INFO     | services.cached_notion_service:get_user_page_content:374 - Retrieved Notion page content for user U089YKL1T4H (length: 618)
2025-05-12 15:25:46.593 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:25:46.594 | INFO     | utils.context_builder:get_enhanced_user_context:21 - Building enhanced context for user U089YKL1T4H
2025-05-12 15:25:46.594 | INFO     | utils.context_builder:get_enhanced_user_context:23 - Using preferred name: Dinorama
2025-05-12 15:25:46.594 | INFO     | utils.context_builder:get_enhanced_user_context:26 - Page content length: 618 chars
2025-05-12 15:25:46.594 | INFO     | utils.context_builder:get_enhanced_user_context:89 - Generated enhanced context length: 1366 chars
2025-05-12 15:25:46.594 | INFO     | actions.action_framework:execute:280 - History retrieval mode: recent
2025-05-12 15:25:46.595 | INFO     | actions.action_framework:execute:281 - Retrieved 20 relevant messages
2025-05-12 15:25:46.595 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:25:47.026 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== IMPORTANT USER PREFERENCES - FOLLOW THESE EXACTLY ===
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion
=== END USER PREFERENCES ===

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker

## Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion

## Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail

## Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
I like Juan Luis Guerrra y $40,
=== END USER PROFILE CONTENT ===

REMINDER: Always respect this user's stated preferences in your responses.
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific preferences or instructions, you MUST follow them without fail.
USER: roberto: What do I like <@U08RG89NFK7>?
USER: roberto: Remember that I like Juan Luis Guerrra y $40, <@U08RG89NFK7>
USER: roberto: Remember that I like Skittles <@U08RG89NFK7>
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: Use the context above to respond to the user's message: "What do I like ?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 15:25:47.027 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:25:47.028 | INFO     | handler.openai_service:get_completion_async:156 - Sending 1116 tokens to OpenAI async. Model: gpt-4o
2025-05-12 15:26:17.204 | INFO     | actions.action_framework:__init__:712 - ActionRouter initialized with 4 actions
2025-05-12 15:26:17.210 | INFO     | actions.action_framework:_get_action_for_text:726 - Selected action ContextResponseAction for message: What projects am I working on, <@U08RG89NFK7>?...
2025-05-12 15:26:17.213 | INFO     | utils.history_manager:retrieve_and_filter_history:237 - History retrieval strategy: Recent context only
2025-05-12 15:26:17.213 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747077976.969019 (limit: 20)...
2025-05-12 15:26:17.474 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747077976.969019.
2025-05-12 15:26:17.476 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 20)...
2025-05-12 15:26:17.975 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 20 messages from channel C08S6PE143A.
2025-05-12 15:26:17.975 | INFO     | utils.history_manager:retrieve_and_filter_history:271 - Retrieved 20 messages, filtered to 20
2025-05-12 15:26:17.976 | INFO     | actions.action_framework:execute:252 - Fetching Notion context for user U089YKL1T4H
2025-05-12 15:26:17.977 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:26:17.979 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:26:17.979 | INFO     | utils.context_builder:get_enhanced_user_context:21 - Building enhanced context for user U089YKL1T4H
2025-05-12 15:26:17.979 | INFO     | utils.context_builder:get_enhanced_user_context:23 - Using preferred name: Dinorama
2025-05-12 15:26:17.979 | INFO     | utils.context_builder:get_enhanced_user_context:26 - Page content length: 618 chars
2025-05-12 15:26:17.979 | INFO     | utils.context_builder:get_enhanced_user_context:89 - Generated enhanced context length: 1366 chars
2025-05-12 15:26:17.979 | INFO     | actions.action_framework:execute:280 - History retrieval mode: recent
2025-05-12 15:26:17.980 | INFO     | actions.action_framework:execute:281 - Retrieved 20 relevant messages
2025-05-12 15:26:17.980 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:26:17.981 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== IMPORTANT USER PREFERENCES - FOLLOW THESE EXACTLY ===
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion
=== END USER PREFERENCES ===

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker

## Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion

## Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail

## Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
I like Juan Luis Guerrra y $40,
=== END USER PROFILE CONTENT ===

REMINDER: Always respect this user's stated preferences in your responses.
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific preferences or instructions, you MUST follow them without fail.
USER: roberto: What projects am I working on, <@U08RG89NFK7>?
USER: roberto: What do I like <@U08RG89NFK7>?
USER: roberto: Remember that I like Juan Luis Guerrra y $40, <@U08RG89NFK7>
USER: roberto: Remember that I like Skittles <@U08RG89NFK7>
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: Use the context above to respond to the user's message: "What projects am I working on, ?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 15:26:17.982 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:26:17.983 | INFO     | handler.openai_service:get_completion_async:156 - Sending 1117 tokens to OpenAI async. Model: gpt-4o
2025-05-12 15:27:09.133 | INFO     | actions.action_framework:__init__:712 - ActionRouter initialized with 4 actions
2025-05-12 15:27:09.141 | INFO     | actions.action_framework:_get_action_for_text:726 - Selected action ContextResponseAction for message: Please add ChatDJS as a project Im working on now....
2025-05-12 15:27:09.145 | INFO     | utils.history_manager:retrieve_and_filter_history:237 - History retrieval strategy: Recent context only
2025-05-12 15:27:09.145 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747077976.969019 (limit: 20)...
2025-05-12 15:27:09.397 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 3 messages from thread 1747077976.969019.
2025-05-12 15:27:09.398 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 20)...
2025-05-12 15:27:09.657 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 20 messages from channel C08S6PE143A.
2025-05-12 15:27:09.657 | INFO     | utils.history_manager:retrieve_and_filter_history:271 - Retrieved 22 messages, filtered to 20
2025-05-12 15:27:09.872 | INFO     | actions.action_framework:execute:252 - Fetching Notion context for user U089YKL1T4H
2025-05-12 15:27:09.873 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:27:09.873 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:27:09.873 | INFO     | utils.context_builder:get_enhanced_user_context:21 - Building enhanced context for user U089YKL1T4H
2025-05-12 15:27:09.874 | INFO     | utils.context_builder:get_enhanced_user_context:23 - Using preferred name: Dinorama
2025-05-12 15:27:09.874 | INFO     | utils.context_builder:get_enhanced_user_context:26 - Page content length: 618 chars
2025-05-12 15:27:09.874 | INFO     | utils.context_builder:get_enhanced_user_context:89 - Generated enhanced context length: 1366 chars
2025-05-12 15:27:09.874 | INFO     | actions.action_framework:execute:280 - History retrieval mode: recent
2025-05-12 15:27:09.874 | INFO     | actions.action_framework:execute:281 - Retrieved 20 relevant messages
2025-05-12 15:27:09.874 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:27:09.876 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== IMPORTANT USER PREFERENCES - FOLLOW THESE EXACTLY ===
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion
=== END USER PREFERENCES ===

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker

## Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion

## Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail

## Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
I like Juan Luis Guerrra y $40,
=== END USER PROFILE CONTENT ===

REMINDER: Always respect this user's stated preferences in your responses.
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific preferences or instructions, you MUST follow them without fail.
USER: roberto: What projects am I working on, <@U08RG89NFK7>?
ASSISTANT: Your projects are threefold, for all to see,  
VibeCode AI and Stacey Hub's glee,  
Plus the PR Legislative Tracker's spree.
USER: roberto: Please add ChatDJS as a project Im working on now. And this is the most important project. <@U08RG89NFK7>
USER: roberto: What do I like <@U08RG89NFK7>?
USER: roberto: Remember that I like Juan Luis Guerrra y $40, <@U08RG89NFK7>
USER: roberto: Remember that I like Skittles <@U08RG89NFK7>
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: Use the context above to respond to the user's message: "Please add ChatDJS as a project Im working on now. And this is the most important project.".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 15:27:09.876 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:27:09.877 | INFO     | handler.openai_service:get_completion_async:156 - Sending 1156 tokens to OpenAI async. Model: gpt-4o
2025-05-12 15:27:38.323 | INFO     | actions.action_framework:__init__:712 - ActionRouter initialized with 4 actions
2025-05-12 15:27:38.328 | INFO     | actions.action_framework:_get_action_for_text:726 - Selected action ContextResponseAction for message: <@U08RG89NFK7> can you please summarize the channe...
2025-05-12 15:27:38.329 | INFO     | utils.history_manager:retrieve_and_filter_history:237 - History retrieval strategy: Channel summarization
2025-05-12 15:27:38.329 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747078057.522449 (limit: 1000)...
2025-05-12 15:27:38.614 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747078057.522449.
2025-05-12 15:27:38.617 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 50)...
2025-05-12 15:27:38.992 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 50 messages from channel C08S6PE143A.
2025-05-12 15:27:38.992 | INFO     | utils.history_manager:retrieve_and_filter_history:271 - Retrieved 50 messages, filtered to 50
2025-05-12 15:27:39.231 | INFO     | actions.action_framework:execute:252 - Fetching Notion context for user U089YKL1T4H
2025-05-12 15:27:39.231 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:27:39.232 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:27:39.232 | INFO     | utils.context_builder:get_enhanced_user_context:21 - Building enhanced context for user U089YKL1T4H
2025-05-12 15:27:39.232 | INFO     | utils.context_builder:get_enhanced_user_context:23 - Using preferred name: Dinorama
2025-05-12 15:27:39.232 | INFO     | utils.context_builder:get_enhanced_user_context:26 - Page content length: 618 chars
2025-05-12 15:27:39.233 | INFO     | utils.context_builder:get_enhanced_user_context:89 - Generated enhanced context length: 1366 chars
2025-05-12 15:27:39.233 | INFO     | actions.action_framework:execute:280 - History retrieval mode: summarize
2025-05-12 15:27:39.233 | INFO     | actions.action_framework:execute:281 - Retrieved 50 relevant messages
2025-05-12 15:27:39.233 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:27:39.237 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== IMPORTANT USER PREFERENCES - FOLLOW THESE EXACTLY ===
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion
=== END USER PREFERENCES ===

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker

## Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion

## Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail

## Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
I like Juan Luis Guerrra y $40,
=== END USER PROFILE CONTENT ===

REMINDER: Always respect this user's stated preferences in your responses.
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific preferences or instructions, you MUST follow them without fail.
USER: roberto: <@U08RG89NFK7> can you please summarize the channel?
USER: roberto: What projects am I working on, <@U08RG89NFK7>?
USER: roberto: What do I like <@U08RG89NFK7>?
USER: roberto: Remember that I like Juan Luis Guerrra y $40, <@U08RG89NFK7>
USER: roberto: Remember that I like Skittles <@U08RG89NFK7>
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: ok, now: <@U08RG89NFK7> where do I live?
USER: roberto: <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey, <@U08RG89NFK7> who was Arthur Ashe?
USER: roberto: Hey <@U08RG89NFK7> when you answer can you write your answers in iambic pentameter?
USER: roberto: Hey <@U08RG89NFK7> I work from Arequipa
USER: roberto: <@U08RG89NFK7> can you call me Dinorama?
USER: roberto: <@U08RG89NFK7> what is the square root of 121?
USER: roberto: Hey <@U08RG89NFK7> what do you know about Joan of Arc?
USER: roberto: Who was Roberto Clemente, <@U08RG89NFK7>?
USER: roberto: Where do I work <@U08RG89NFK7>?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> who was Alexander The Great?
USER: roberto: <@U08RG89NFK7> what happened in the US Conress in 1954?
USER: roberto: Hola <@U08RG89NFK7> - can you summarize this channel in 7 bullet points?
USER: roberto: Where do I work, <@U08RG89NFK7>?
USER: roberto: Hello <@U08RG89NFK7> I work remotely from Peru
USER: roberto: Hey <@U08RG89NFK7> Where do I work?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: Hey <@U08RG89NFK7> where do I live?
USER: roberto: Hey hey <@U08RG89NFK7> I work remotely from Anchorage
USER: roberto: What do I like, <@U08RG89NFK7>&gt;
USER: roberto: <@U08RG89NFK7> where do I work?
USER: roberto: <@U08RG89NFK7> I work remotely from La Prangana
USER: roberto: I work remotely from La Pampana <@U08RG89NFK7>
USER: roberto: Are you there <@U08N3EFH6SE>?
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: <@U08RG89NFK7> I work remotely from Berlin.
USER: roberto: Hey <@U08RG89NFK7> I work remotely from Greece
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> I work remotely from Spain.
USER: roberto: <@U08RG89NFK7> what do you remember about me?
USER: roberto: <@U08RG89NFK7> what projects am I working on?
USER: Use the context above to respond to the user's message: "can you please summarize the channel?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 15:27:39.237 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:27:39.240 | INFO     | handler.openai_service:get_completion_async:156 - Sending 1867 tokens to OpenAI async. Model: gpt-4o
2025-05-12 15:29:17.241 | INFO     | actions.action_framework:__init__:712 - ActionRouter initialized with 4 actions
2025-05-12 15:29:17.243 | INFO     | actions.action_framework:_get_action_for_text:726 - Selected action ContextResponseAction for message: Has anyone discussed Roberto Clemente, <@U08RG89NF...
2025-05-12 15:29:17.247 | INFO     | utils.history_manager:extract_search_terms:133 - Extracted search terms: ['roberto clemente, ? if so, what was discussed?']
2025-05-12 15:29:17.247 | INFO     | utils.history_manager:retrieve_and_filter_history:237 - History retrieval strategy: Search for terms: roberto clemente, ? if so, what was discussed?
2025-05-12 15:29:17.248 | INFO     | services.slack_service:fetch_thread_history:204 - Fetching thread history for C08S6PE143A, ts: 1747078156.077689 (limit: 1000)...
2025-05-12 15:29:17.640 | INFO     | services.slack_service:fetch_thread_history:225 - Fetched 1 messages from thread 1747078156.077689.
2025-05-12 15:29:17.640 | INFO     | services.slack_service:fetch_channel_history:172 - Fetching channel history for C08S6PE143A (limit: 50)...
2025-05-12 15:29:18.143 | INFO     | services.slack_service:fetch_channel_history:192 - Fetched 50 messages from channel C08S6PE143A.
2025-05-12 15:29:18.143 | INFO     | utils.history_manager:retrieve_and_filter_history:271 - Retrieved 50 messages, filtered to 0
2025-05-12 15:29:18.144 | INFO     | actions.action_framework:execute:252 - Fetching Notion context for user U089YKL1T4H
2025-05-12 15:29:18.144 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:29:18.145 | INFO     | services.cached_notion_service:get_user_page_content:310 - Cache hit for user page content: U089YKL1T4H
2025-05-12 15:29:18.145 | INFO     | utils.context_builder:get_enhanced_user_context:21 - Building enhanced context for user U089YKL1T4H
2025-05-12 15:29:18.145 | INFO     | utils.context_builder:get_enhanced_user_context:23 - Using preferred name: Dinorama
2025-05-12 15:29:18.145 | INFO     | utils.context_builder:get_enhanced_user_context:26 - Page content length: 618 chars
2025-05-12 15:29:18.145 | INFO     | utils.context_builder:get_enhanced_user_context:89 - Generated enhanced context length: 1366 chars
2025-05-12 15:29:18.145 | INFO     | actions.action_framework:execute:280 - History retrieval mode: search
2025-05-12 15:29:18.146 | INFO     | actions.action_framework:execute:281 - Retrieved 0 relevant messages
2025-05-12 15:29:18.146 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:29:18.147 | WARNING  | handler.openai_service:get_completion_async:151 -  Full OpenAI prompt:
SYSTEM: You are an assistant embedded in a Slack channel. Your primary job is to answer the user's most recent question directly and concisely. Review the provided message history to understand the immediate context of the user's question. If the user's question is *explicitly about past discussions* in the channel (e.g., 'was X discussed before?', 'what did Y say about Z?'), then you should thoroughly search the history to answer.

=== CRITICALLY IMPORTANT USER-SPECIFIC CONTEXT & PREFERENCES ===
The following information from the user's Notion profile is AUTHORITATIVE and MUST be followed without exception. This information OVERRIDES any other information in the conversation history or your previous knowledge. You MUST follow these instructions exactly as specified:

=== IMPORTANT USER PREFERENCES - FOLLOW THESE EXACTLY ===
* Always write your answers in rhymed verse
* If I'm debugging, be specific and suggest 1-2 fixes at a time
* In Slack threads, remind me to document outcomes in Notion
=== END USER PREFERENCES ===

=== USER DATABASE PROPERTIES ===
* FavoriteEmoji: 
* LanguagePreference: Espaol
* WorkLocation: Peru
* HomeLocation: in san juan, puerto rico
* SlackUserID: U089YKL1T4H
* Role: Vowel
* Timezone: ASD
* SlackDisplayName: roberto
* UserID: U089YKL1T4H
=== END USER DATABASE PROPERTIES ===

 This user's preferred name is: Dinorama 

=== USER PROFILE CONTENT ===

## Projects
VibeCode AI Assistant
Slackbot for Stacey Hub
PR Legislative Tracker

## Preferences
Always write your answers in rhymed verse
If I'm debugging, be specific and suggest 1-2 fixes at a time
In Slack threads, remind me to document outcomes in Notion

## Known Facts
Background in film and tech
Likes AI tools that integrate with Slack and Gmail

## Instructions
When I say "remember X", store it under Known Facts
When I ask "what do you remember about me?", return all facts
When I say "my new project is Y", replace the Projects list
When I say "add project Z", append to the Projects list
I like Juan Luis Guerrra y $40,
=== END USER PROFILE CONTENT ===

REMINDER: Always respect this user's stated preferences in your responses.
=== END USER-SPECIFIC CONTEXT & PREFERENCES ===

IMPORTANT: You MUST incorporate the above user-specific information into your response. If the user has specific preferences or instructions, you MUST follow them without fail.
USER: Use the context above to respond to the user's message: "Has anyone discussed Roberto Clemente, ? If so, what was discussed?".
Provide a concise, helpful response as if participating in the same Slack conversation.
2025-05-12 15:29:18.147 | WARNING  | utils.token_management:get_encoder_for_model:19 - Model gpt-4o not found in tiktoken. Falling back to cl100k_base.
2025-05-12 15:29:18.150 | INFO     | handler.openai_service:get_completion_async:156 - Sending 607 tokens to OpenAI async. Model: gpt-4o
